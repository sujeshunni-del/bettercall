<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Career Assessment | Better Call Immigration</title>
    <meta name="description" content="AI-Powered Career Assessment for Global Migration">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Barcode Font for Authenticity -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Flatpickr (Stylish Date Picker) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Tailwind CSS (Warning Suppressed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning for cleaner console
        console.warn = function() {}; 

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#0a0a0a',
                        'brand-primary': '#00f2ff', /* Cyan Neon */
                        'brand-secondary': '#7000ff', /* Deep Violet */
                        'brand-accent': '#ff0055', /* Hot Pink */
                        'brand-gold': '#ffd700',
                        'glass-surface': 'rgba(255, 255, 255, 0.03)',
                        'glass-border': 'rgba(255, 255, 255, 0.08)',
                        'glass-highlight': 'rgba(255, 255, 255, 0.15)',
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        barcode: ['"Libre Barcode 39 Text"', 'cursive'],
                    },
                    boxShadow: {
                        'neon-blue': '0 0 20px rgba(0, 242, 255, 0.3)',
                        'neon-pink': '0 0 20px rgba(255, 0, 85, 0.3)',
                        'glass-lg': '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up-fade': 'slideUpFade 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        slideUpFade: {
                            '0%': { transform: 'translateY(40px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        popIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE & BACKGROUND */
        body {
            background-color: #050505;
            color: #e2e8f0;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        /* Ambient Orbs Background */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
            background: radial-gradient(circle at 50% 50%, #111 0%, #000 100%);
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: blob 20s infinite alternate;
        }
        .orb-1 { width: 600px; height: 600px; background: #7000ff; top: -100px; left: -100px; animation-delay: 0s; }
        .orb-2 { width: 500px; height: 500px; background: #00f2ff; bottom: -100px; right: -100px; animation-delay: -5s; }
        .orb-3 { width: 400px; height: 400px; background: #ff0055; top: 40%; left: 40%; animation-delay: -10s; opacity: 0.2; }

        /* GLASSMORPHISM 2.0 PANEL */
        .glass-panel {
            background: rgba(20, 20, 20, 0.4);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: visible; 
        }
        /* Shine effect on top edge */
        .glass-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }

        /* INPUTS */
        .form-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(4px);
        }
        .form-input:hover {
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.03);
        }
        .form-input:focus {
            border-color: #00f2ff;
            background: rgba(0, 242, 255, 0.05);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
            outline: none;
        }

        /* SPECIAL GEOGRAPHY INPUTS */
        .geo-input {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }
        .geo-input:focus {
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.15);
        }
        .geo-input option {
            background-color: #1a1a1a;
            color: #ffd700;
        }

        /* DATE PICKER WRAPPER */
        .date-input-container {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .date-input-container:hover {
            border-color: #7000ff;
            box-shadow: 0 0 10px rgba(112, 0, 255, 0.2);
        }
        .date-icon-box {
            padding: 0 1rem;
            color: #7000ff;
            background: rgba(112, 0, 255, 0.1);
            height: 100%;
            display: flex;
            align-items: center;
            border-right: 1px solid rgba(112, 0, 255, 0.2);
        }
        .date-input-container input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            padding: 0.75rem 1rem;
            outline: none;
        }

        /* UTILS */
        .uppercase-input { text-transform: uppercase; }
        .valid-field { border-color: #00ff88 !important; box-shadow: 0 0 10px rgba(0, 255, 136, 0.2) !important; }
        .invalid-field { border-color: #ff0055 !important; box-shadow: 0 0 10px rgba(255, 0, 85, 0.2) !important; }

        /* CATEGORY CARDS */
        .category-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .category-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .category-card.active {
            background: linear-gradient(135deg, rgba(0, 242, 255, 0.1) 0%, rgba(112, 0, 255, 0.1) 100%);
            border-color: #00f2ff;
            box-shadow: 0 10px 30px rgba(0, 242, 255, 0.15);
        }

        /* DROPDOWN SCROLLBAR */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #00f2ff; border-radius: 10px; }
        
        /* CIRCULAR PROGRESS */
        .circular-chart { display: block; margin: 0 auto; max-width: 100%; max-height: 250px; }
        .circle-bg { fill: none; stroke: rgba(255, 255, 255, 0.05); stroke-width: 2.5; }
        .circle { fill: none; stroke-width: 2.5; stroke-linecap: round; animation: progress 1.5s ease-out forwards; }
        @keyframes progress { 0% { stroke-dasharray: 0 100; } }
        .percentage { fill: #fff; font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 0.5em; text-anchor: middle; }

        /* BUTTON GRADIENTS */
        .btn-gradient {
            background-size: 200% auto;
            background-image: linear-gradient(to right, #00f2ff 0%, #7000ff 51%, #00f2ff 100%);
            transition: 0.5s;
        }
        .btn-gradient:hover { background-position: right center; }

        /* CUSTOM MODAL */
        #messageModal { backdrop-filter: blur(8px); }
        .modal-content {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Ambient Background -->
    <div class="ambient-light">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Header -->
    <nav class="fixed w-full z-50 transition-all duration-300 backdrop-blur-md bg-black/20 border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center text-white font-bold text-2xl shadow-neon-blue animate-float">
                        <i class="fa-solid fa-plane-departure transform -rotate-12"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-2xl tracking-tighter text-white">Better Call <span class="text-brand-primary drop-shadow-[0_0_10px_rgba(0,242,255,0.5)]">Immigration</span></h1>
                        <p class="text-[10px] text-brand-primary uppercase tracking-[0.2em] font-semibold opacity-80">Global Assessment Portal</p>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-32 pb-12 px-4 relative z-10">
        <div class="max-w-6xl mx-auto">
            
            <!-- Progress Steps (Glowing Nodes) -->
            <div class="mb-16 relative">
                <!-- Connecting Line -->
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-0.5 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
                
                <div class="flex items-center justify-center gap-16 relative z-10">
                    <!-- Step 1 -->
                    <div id="step-1-indicator" class="flex flex-col items-center gap-3 transition-all duration-500">
                        <div class="w-12 h-12 rounded-full bg-brand-dark border-2 border-brand-primary shadow-neon-blue flex items-center justify-center text-brand-primary text-lg font-bold">1</div>
                        <span class="font-medium text-sm text-brand-primary tracking-widest uppercase text-shadow-glow">Profile</span>
                    </div>
                    
                    <!-- Step 2 -->
                    <div id="step-2-indicator" class="flex flex-col items-center gap-3 transition-all duration-500 opacity-50 grayscale">
                        <div class="w-12 h-12 rounded-full bg-brand-dark border-2 border-white/20 flex items-center justify-center text-white text-lg font-bold">2</div>
                        <span class="font-medium text-sm text-gray-400 tracking-widest uppercase">Report</span>
                    </div>
                </div>
            </div>

            <!-- TAB 1: Personal Details -->
            <div id="tab-1" class="glass-panel rounded-3xl p-8 md:p-12 animate-slide-up-fade max-w-4xl mx-auto">
                <div class="mb-10 text-center">
                    <h2 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-gray-200 to-gray-500 mb-3">Begin Your Journey</h2>
                    <p class="text-gray-400 text-sm tracking-wide">Enter details as per your official documents.</p>
                </div>

                <form id="personalForm" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Name & Surname -->
                    <div class="group">
                        <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Given Name</label>
                        <input type="text" id="firstName" required class="form-input uppercase-input w-full rounded-xl px-5 py-4 text-lg font-medium" placeholder="JOHN" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="group">
                        <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Surname</label>
                        <input type="text" id="lastName" required class="form-input uppercase-input w-full rounded-xl px-5 py-4 text-lg font-medium" placeholder="DOE" oninput="this.value = this.value.toUpperCase()">
                    </div>

                    <!-- Date of Birth & Age -->
                    <div>
                        <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">
                            <i class="fa-regular fa-calendar-days mr-1"></i> Date of Birth
                        </label>
                        <div class="date-input-container rounded-xl">
                            <div class="date-icon-box"><i class="fa-solid fa-cake-candles"></i></div>
                            <input type="text" id="dob" required placeholder="Select Date" class="text-lg">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-widest mb-3 ml-1">Age</label>
                        <input type="text" id="age" readonly class="form-input w-full rounded-xl px-5 py-4 bg-white/5 text-gray-400 cursor-not-allowed font-mono">
                        <p id="ageError" class="text-brand-accent text-[11px] hidden mt-2 font-bold flex items-center gap-2 animate-pulse"><i class="fa-solid fa-triangle-exclamation"></i> Must be 20+ years.</p>
                    </div>

                    <!-- GEOGRAPHY SECTION (Gold Styled) -->
                    <div class="md:col-span-2 relative p-6 rounded-2xl border border-brand-gold/30 bg-gradient-to-br from-brand-gold/5 to-transparent overflow-hidden">
                        <!-- Decorative bg element -->
                        <div class="absolute -top-10 -right-10 w-32 h-32 bg-brand-gold/20 blur-3xl rounded-full"></div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10">
                            <!-- Nationality -->
                            <div>
                                <label class="block text-xs font-black text-brand-gold uppercase tracking-widest mb-3 ml-1 drop-shadow-sm">
                                    <i class="fa-solid fa-earth-americas mr-1"></i> Nationality
                                </label>
                                <div class="relative">
                                    <select id="nationality" required class="geo-input w-full rounded-xl px-5 py-4 font-bold uppercase appearance-none" onchange="handleNationalityChange()">
                                        <option value="">Select Origin</option>
                                        <option value="INDIA" data-code="+91">India</option>
                                        <option value="PAKISTAN" data-code="+92">Pakistan</option>
                                        <option value="NEPAL" data-code="+977">Nepal</option>
                                        <option value="SRILANKA" data-code="+94">Sri Lanka</option>
                                        <option value="BANGLADESH" data-code="+880">Bangladesh</option>
                                        <option value="PHILIPPINES" data-code="+63">Philippines</option>
                                        <option value="EGYPT" data-code="+20">Egypt</option>
                                        <option value="AFRICA" data-code="+234">Africa (Region)</option>
                                        <option value="OTHER" data-code="">Other</option>
                                    </select>
                                    <div class="absolute right-5 top-1/2 -translate-y-1/2 text-brand-gold pointer-events-none"><i class="fa-solid fa-chevron-down"></i></div>
                                </div>
                            </div>
                            
                            <!-- State -->
                            <div id="stateContainer">
                                <label class="block text-xs font-black text-brand-gold uppercase tracking-widest mb-3 ml-1 drop-shadow-sm">
                                    <i class="fa-solid fa-map-location-dot mr-1"></i> Province / State
                                </label>
                                <div id="stateInputWrapper" class="relative">
                                     <input type="text" id="state" class="geo-input w-full rounded-xl px-5 py-4 placeholder-brand-gold/40 uppercase opacity-60" placeholder="Select Nationality First" disabled>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact -->
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1">Mobile</label>
                        <div class="relative group">
                            <input type="tel" id="mobile" required class="form-input w-full rounded-xl px-5 py-4 pl-12 font-mono text-lg" placeholder="+91..." oninput="validatePhone('mobile')">
                            <i class="fa-solid fa-phone absolute left-4 top-1/2 -translate-y-1/2 text-brand-primary opacity-60 group-focus-within:opacity-100 transition-opacity"></i>
                            <div id="mobileFeedback" class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold"></div>
                        </div>
                        <p id="mobileError" class="text-brand-accent text-[11px] hidden mt-2 font-bold pl-1">Invalid Format.</p>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">WhatsApp</label>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="sameAsMobile" class="w-4 h-4 rounded border-gray-600 text-brand-primary focus:ring-brand-primary bg-white/5 accent-brand-primary cursor-pointer">
                                <label for="sameAsMobile" class="text-[10px] text-gray-500 cursor-pointer select-none font-bold uppercase tracking-wider">Same as Mobile</label>
                            </div>
                        </div>
                        <div class="relative group">
                            <input type="tel" id="whatsapp" required class="form-input w-full rounded-xl px-5 py-4 pl-12 font-mono text-lg" placeholder="+91..." oninput="validatePhone('whatsapp')">
                            <i class="fa-brands fa-whatsapp absolute left-4 top-1/2 -translate-y-1/2 text-green-400 opacity-60 group-focus-within:opacity-100 transition-opacity"></i>
                            <div id="waFeedback" class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold"></div>
                        </div>
                    </div>

                    <!-- Qualifications -->
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 ml-1">Education Level</label>
                        <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                            <!-- Helper for cleaner HTML repetition -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="UNDER 10 TH" class="peer sr-only" required>
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-school text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">Under 10th</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="SCHOOL" class="peer sr-only">
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-book-open text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">School</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="PLUS TWO" class="peer sr-only">
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-graduation-cap text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">Plus Two</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="DIPLOMA" class="peer sr-only">
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-scroll text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">Diploma</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="BACHELOR" class="peer sr-only">
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-user-graduate text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">Bachelor</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="MASTER" class="peer sr-only">
                                <div class="h-full rounded-xl border border-white/10 bg-white/5 p-4 flex flex-col items-center justify-center text-center gap-2 hover:bg-white/10 peer-checked:bg-brand-primary/10 peer-checked:border-brand-primary peer-checked:shadow-neon-blue transition-all">
                                    <i class="fa-solid fa-medal text-xl text-gray-500 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-gray-400 peer-checked:text-white">Master</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Passport -->
                     <div class="md:col-span-1">
                        <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1">Passport No. (Optional)</label>
                        <input type="text" id="passportNo" class="form-input uppercase-input w-full rounded-xl px-5 py-4 font-mono" placeholder="X1234567" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="md:col-span-1">
                        <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">
                             <i class="fa-solid fa-passport mr-1"></i> Passport Expiry
                        </label>
                        <div class="date-input-container rounded-xl">
                            <div class="date-icon-box"><i class="fa-solid fa-hourglass-half"></i></div>
                            <input type="text" id="passportExp" placeholder="Select Date" class="text-lg">
                        </div>
                    </div>

                    <div class="md:col-span-2 mt-8 flex justify-end">
                        <button type="button" onclick="goToStep2()" id="nextBtn" class="btn-gradient text-white font-bold py-4 px-12 rounded-xl shadow-lg transition-transform hover:scale-105 active:scale-95 flex items-center gap-3">
                            <span class="tracking-wider">NEXT STEP</span>
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- TAB 2: AI Job Report -->
            <div id="tab-2" class="hidden animate-slide-up-fade">
                <!-- 1. CATEGORY SELECTOR -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 max-w-4xl mx-auto">
                    <!-- UNSKILLED OPTION -->
                    <div id="cardUnskilled" onclick="setSkillMode('Unskilled')" class="category-card rounded-3xl p-8 flex items-center gap-6 cursor-pointer relative overflow-hidden">
                        <div class="w-16 h-16 rounded-2xl bg-brand-primary/20 text-brand-primary flex items-center justify-center text-3xl shadow-neon-blue">
                            <i class="fa-solid fa-hands-holding-circle"></i>
                        </div>
                        <div class="z-10">
                            <h3 class="text-xl font-bold text-white mb-1">General / Unskilled</h3>
                            <p class="text-xs text-gray-400 tracking-wide">Factory, Agriculture, Warehouse</p>
                        </div>
                        <div class="ml-auto z-10">
                            <div class="w-8 h-8 rounded-full border-2 border-gray-600 flex items-center justify-center transition-all" id="checkUnskilled">
                                <div class="w-4 h-4 rounded-full bg-brand-primary hidden shadow-[0_0_10px_#00f2ff]"></div>
                            </div>
                        </div>
                    </div>
                    <!-- SKILLED OPTION -->
                    <div id="cardSkilled" onclick="setSkillMode('Skilled')" class="category-card rounded-3xl p-8 flex items-center gap-6 cursor-pointer relative overflow-hidden">
                        <div class="w-16 h-16 rounded-2xl bg-brand-secondary/20 text-brand-secondary flex items-center justify-center text-3xl shadow-[0_0_20px_rgba(112,0,255,0.3)]">
                            <i class="fa-solid fa-user-tie"></i>
                        </div>
                        <div class="z-10">
                            <h3 class="text-xl font-bold text-white mb-1">Skilled Professional</h3>
                            <p class="text-xs text-gray-400 tracking-wide">Engineer, IT, Medical, Trades</p>
                        </div>
                        <div class="ml-auto z-10">
                            <div class="w-8 h-8 rounded-full border-2 border-gray-600 flex items-center justify-center transition-all" id="checkSkilled">
                                <div class="w-4 h-4 rounded-full bg-brand-secondary hidden shadow-[0_0_10px_#7000ff]"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. JOB DETAILS FORM -->
                <div id="jobDetailsPanel" class="glass-panel rounded-3xl p-8 mb-12 hidden animate-pop-in relative z-20 max-w-4xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                        
                        <!-- STYLISH DROP DOWN -->
                        <div class="relative group" id="customJobSelect">
                            <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Target Position</label>
                            
                            <!-- Trigger -->
                            <button type="button" class="form-input w-full text-left rounded-xl px-5 py-4 flex justify-between items-center cursor-pointer" onclick="toggleJobDropdown(event)">
                                <span id="selectedJobText" class="text-gray-400 font-medium">Select Role</span>
                                <i class="fa-solid fa-chevron-up transition-transform duration-300 text-brand-primary" id="jobDropdownIcon"></i>
                            </button>

                            <!-- Drop Down List -->
                            <div id="jobDropdownList" class="hidden absolute top-full left-0 w-full mt-2 bg-[#0f0f0f] border border-brand-primary/30 rounded-2xl shadow-neon-blue max-h-80 overflow-y-auto z-50 custom-scrollbar transform origin-top transition-all duration-300">
                                <!-- JS Injected -->
                            </div>
                            
                            <input type="hidden" id="currentJob">
                        </div>

                        <!-- EXPERIENCE -->
                        <div id="experienceWrapper" class="hidden animate-pop-in">
                            <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">Years of Experience</label>
                            <div class="relative">
                                <input type="number" id="experience" min="1" max="30" value="1" class="form-input w-full rounded-xl px-5 py-4 font-bold text-lg" placeholder="Min 1" onblur="validateExperienceInput(this)">
                                <div class="absolute right-5 top-1/2 -translate-y-1/2 text-xs text-brand-secondary font-black tracking-widest">YEARS</div>
                            </div>
                        </div>

                        <div class="md:col-span-2 flex justify-end mt-4">
                             <button onclick="generateReport()" class="w-full md:w-auto btn-gradient text-white font-bold py-4 px-10 rounded-xl shadow-lg flex items-center justify-center gap-3 group">
                                <i class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition-transform"></i> 
                                <span>GENERATE ANALYSIS</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 3. REPORT DASHBOARD -->
                <div id="reportContainer" class="hidden max-w-5xl mx-auto">
                    <div class="glass-panel p-1 rounded-3xl animate-slide-up-fade">
                        <div class="bg-black/40 rounded-[22px] p-8 md:p-12 relative overflow-hidden">
                            
                            <!-- Authentic "Stamp" -->
                            <div class="absolute top-10 right-10 rotate-12 opacity-20 pointer-events-none border-4 border-green-500 rounded px-4 py-2 text-green-500 font-black text-4xl uppercase tracking-widest">
                                APPROVED
                            </div>

                            <!-- Report Header -->
                            <div class="flex flex-wrap justify-between items-start border-b border-white/10 pb-6 mb-8 gap-6 relative z-10">
                                <div>
                                    <h2 class="text-3xl font-black text-white tracking-wide mb-2"><span class="text-brand-primary">AI</span> STRATEGIC REPORT</h2>
                                    <p class="text-xs text-brand-gold uppercase tracking-[0.3em] font-bold">Confidential Assessment</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-barcode text-5xl text-gray-500 opacity-50 mb-1" id="barcodeRef"></div>
                                    <div class="inline-block bg-white/5 px-4 py-2 rounded-lg text-xs font-mono text-brand-primary border border-brand-primary/30 shadow-[0_0_10px_rgba(0,242,255,0.1)]">CASE ID: <span id="refId"></span></div>
                                    <div class="text-[10px] text-gray-500 mt-2 uppercase tracking-wider" id="reportDate"></div>
                                </div>
                            </div>

                            <!-- User Identity Strip (ENHANCED) -->
                            <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-10 bg-white/5 p-6 rounded-2xl border border-white/5 hover:border-brand-primary/30 transition-colors relative">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center font-bold text-3xl text-white shadow-lg shrink-0" id="avatarInitial"></div>
                                
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4 w-full">
                                    <!-- Name -->
                                    <div class="col-span-2 md:col-span-1">
                                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Candidate Name</div>
                                        <h3 class="text-xl font-bold text-white truncate" id="reportName"></h3>
                                    </div>
                                    
                                    <!-- Profession -->
                                    <div class="col-span-2 md:col-span-1">
                                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Profession</div>
                                        <div class="flex items-center gap-2 text-brand-primary font-medium truncate">
                                            <i class="fa-solid fa-user-tag text-xs"></i> <span id="reportRole"></span>
                                        </div>
                                    </div>

                                    <!-- Qualification -->
                                    <div class="col-span-1">
                                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Qualification</div>
                                        <div class="text-white font-medium truncate" id="reportQualification"></div>
                                    </div>

                                    <!-- Experience -->
                                    <div class="col-span-1">
                                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Experience</div>
                                        <div class="flex items-center gap-2">
                                            <span class="bg-brand-secondary/20 border border-brand-secondary/50 px-3 py-0.5 rounded-full text-white text-sm font-bold shadow-[0_0_10px_rgba(112,0,255,0.3)]">
                                                <span id="reportExp"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Main Intelligence Grid -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
                                
                                <!-- Hero Match Card -->
                                <div class="lg:col-span-2 rounded-3xl p-1 bg-gradient-to-br from-brand-primary via-brand-secondary to-transparent">
                                    <div class="h-full bg-[#0a0a0a] rounded-[22px] p-8 relative overflow-hidden flex flex-col justify-between">
                                        <!-- Background Glow -->
                                        <div class="absolute top-0 right-0 w-64 h-64 bg-brand-primary/10 blur-[80px] rounded-full pointer-events-none"></div>
                                        
                                        <div class="relative z-10">
                                            <div class="flex justify-between items-start mb-6">
                                                <div class="flex items-center gap-3">
                                                    <i class="fa-solid fa-crown text-brand-gold text-2xl drop-shadow-md"></i>
                                                    <h4 class="text-xs font-bold text-brand-primary uppercase tracking-widest">Primary Recommendation</h4>
                                                </div>
                                                <div class="bg-brand-primary/10 px-3 py-1 rounded border border-brand-primary/20 text-brand-primary text-xs font-bold">
                                                    HIGH PROBABILITY
                                                </div>
                                            </div>

                                            <div class="mb-6">
                                                <h1 class="text-5xl font-black text-white mb-2 tracking-tight" id="topMatchCountry">Country</h1>
                                                <div class="text-lg text-gray-400 font-light flex items-center gap-2">
                                                    <span id="topMatchRole" class="text-white">Role</span>
                                                    <span class="text-gray-600">|</span>
                                                    <span class="text-brand-gold font-bold" id="mainSalaryRange">€0 - €0 / Month</span>
                                                </div>
                                            </div>
                                            
                                            <!-- Stats -->
                                            <div class="grid grid-cols-3 gap-4 mb-6">
                                                <div class="bg-white/5 p-4 rounded-xl border border-white/5 text-center">
                                                    <div class="text-[9px] text-gray-500 uppercase font-black mb-1">Success Rate</div>
                                                    <div class="text-lg font-bold text-green-400">98%</div>
                                                </div>
                                                <div class="bg-white/5 p-4 rounded-xl border border-white/5 text-center">
                                                    <div class="text-[9px] text-gray-500 uppercase font-black mb-1">Processing</div>
                                                    <div class="text-lg font-bold text-white">3-5 Mo.</div>
                                                </div>
                                                <div class="bg-white/5 p-4 rounded-xl border border-white/5 text-center">
                                                    <div class="text-[9px] text-gray-500 uppercase font-black mb-1">Visa Type</div>
                                                    <div class="text-lg font-bold text-brand-primary">Work</div>
                                                </div>
                                            </div>

                                            <!-- Analysis Text -->
                                            <div class="pt-6 border-t border-white/10">
                                                <h5 class="text-xs font-bold text-white mb-3 flex items-center gap-2">
                                                    <i class="fa-solid fa-microchip text-brand-secondary"></i> AI ANALYSIS
                                                </h5>
                                                <p class="text-sm text-gray-400 leading-relaxed italic" id="aiReasoning">
                                                    Processing data...
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Sidebar -->
                                <div class="flex flex-col gap-6">
                                    <!-- Score Gauge -->
                                    <div class="bg-white/5 rounded-3xl p-8 flex flex-col items-center justify-center border border-white/5 relative overflow-hidden flex-1">
                                        <svg viewBox="0 0 36 36" class="circular-chart w-32 h-32">
                                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path class="circle text-brand-gold drop-shadow-[0_0_10px_rgba(255,215,0,0.5)]" stroke-dasharray="92, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke="currentColor" />
                                            <text x="18" y="20.35" class="percentage text-[0.4em]">9.2</text>
                                        </svg>
                                        <div class="text-xs font-bold text-brand-gold mt-4 uppercase tracking-widest text-center">Eligibility<br>Index</div>
                                    </div>

                                    <!-- CTA -->
                                    <button id="mainActionBtn" class="bg-white hover:bg-brand-primary text-black font-black py-5 rounded-2xl transition-all shadow-lg flex items-center justify-center gap-2 group relative overflow-hidden">
                                        <span class="relative z-10">BOOK CONSULT</span>
                                        <i class="fa-solid fa-arrow-right relative z-10 group-hover:translate-x-1 transition-transform"></i>
                                        <div class="absolute inset-0 bg-brand-primary transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></div>
                                    </button>
                                    
                                    <!-- NEW: Download Record Button -->
                                    <button onclick="downloadRecord()" class="bg-brand-dark/50 hover:bg-white/10 text-gray-400 hover:text-white font-bold py-3 rounded-2xl border border-white/10 transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                                        <i class="fa-solid fa-download"></i> Download Data (Excel)
                                    </button>
                                </div>
                            </div>

                            <!-- Alternatives -->
                            <div>
                                <h4 class="text-xs font-black text-gray-500 uppercase mb-6 tracking-widest flex items-center gap-2">
                                    <i class="fa-solid fa-network-wired"></i> Strategic Alternatives
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="altMatchesGrid">
                                    <!-- JS Injected Items -->
                                </div>
                            </div>
                            
                            <!-- Footer -->
                            <div class="mt-10 text-[10px] text-gray-600 text-center border-t border-white/5 pt-6 font-mono">
                                GENERATED BY BETTER CALL IMMIGRATION AI ENGINE v2.0
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>
    
    <footer class="border-t border-white/5 bg-black/40 py-8 mt-auto backdrop-blur-sm relative z-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-xs">© 2024 Better Call Immigration. Designed for the Future.</p>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-8 transform translate-y-32 opacity-0 transition-all duration-500 z-50">
        <div class="glass-panel border-l-4 border-brand-primary text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4">
            <div class="w-8 h-8 rounded-full bg-brand-primary/20 flex items-center justify-center text-brand-primary">
                <i class="fa-solid fa-check"></i>
            </div>
            <div>
                <h4 class="font-bold text-sm">Success</h4>
                <span class="text-xs text-gray-400" id="toastMsg">Assessment Saved Securely</span>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Errors (Replaces Alert) -->
    <div id="messageModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/50 opacity-0 transition-opacity duration-300">
        <div class="modal-content w-full max-w-sm rounded-2xl p-6 transform scale-90 transition-transform duration-300 text-center">
            <div class="w-12 h-12 rounded-full bg-brand-accent/20 text-brand-accent flex items-center justify-center text-xl mx-auto mb-4 shadow-[0_0_15px_rgba(255,0,85,0.4)]">
                <i class="fa-solid fa-circle-exclamation"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Attention Needed</h3>
            <p id="modalText" class="text-gray-400 text-sm mb-6">Please check your inputs.</p>
            <button onclick="closeModal()" class="w-full bg-brand-accent hover:bg-red-500 text-white font-bold py-3 rounded-xl transition-all shadow-lg">
                UNDERSTOOD
            </button>
        </div>
    </div>

    <script>
        // Suppress Tailwind CDN warning for cleaner console
        console.warn = function() {}; 

        // ==========================================
        //  CONFIGURATION AREA
        // ==========================================
        
        const CLICKUP_API_KEY = "pk_260468481_DGN3UIQ1QIOC3C2V3M3UG9XFE8SCXXCH"; 
        const CLICKUP_LIST_ID = "901813907839"; 
        
        // ----------------------------------------------------
        //  CLICKUP CUSTOM FIELD IDs
        //  Updated Config to match user request (name = task name, others fields)
        // ----------------------------------------------------
        const CLICKUP_FIELDS = {
            "SUR NAME": "34d446a2-fe50-45bc-8e3b-64660ebdd6f7",  
            "MOBILE": "5693724c-ee50-469b-a4a9-3848fe6d3115", 
            "WHATSAPP": "87b4eee7-444f-4ec4-9882-441965757a68", 
            "DATE OF BIRTH": "72d7dec6-eb69-4d1d-b5ea-af6e99d28a38",    
            "AGE": "f4ba427f-6e9c-4aa2-ae5c-8159e1254d2c",    
            "QUALIFICATION": "2cd34df4-98b5-4c82-8d86-a34bf3c1618b",
            "PROFESSION": "7dcb9f47-cf7a-4108-b42c-a5f84541b0d2",  
            "NATIONALITY": "e79e1c4e-b123-4bd9-8051-34859ea4b87e", 
            "STATE": "e65a622e-be4b-4367-ac2a-4d3b89907d96",  
            "EXPERIENCE": "267d8fd1-cc80-4343-972a-4a1d45cab5d7", 
            "PASSPORT NUMBER": "b8798515-8962-40a7-a8cd-2685f9fd676c",
            "PASSPORT EXPIRY": "5aa1bec5-f188-4ef7-8f7d-2b4778fbe738", 
            "Case Reference ID": "a25c1d42-6191-4fde-8eb4-7f2059fd71e3"
        };

        // SALARY DATA (New Logic Engine)
        const salaryDb = {
            "Netherlands": { u: "€1,800 - €2,400", s: "€3,200 - €4,500" },
            "Germany": { u: "€1,600 - €2,200", s: "€3,500 - €5,000" },
            "Sweden": { u: "€1,700 - €2,300", s: "€3,000 - €4,200" },
            "Finland": { u: "€1,600 - €2,100", s: "€2,800 - €4,000" },
            "France": { u: "€1,500 - €1,900", s: "€2,500 - €3,800" },
            "Italy": { u: "€1,200 - €1,600", s: "€2,000 - €3,000" },
            "Czech Republic": { u: "€900 - €1,200", s: "€1,500 - €2,500" },
            "Poland": { u: "€800 - €1,100", s: "€1,400 - €2,200" },
            "Croatia": { u: "€700 - €1,000", s: "€1,200 - €2,000" },
            "Latvia": { u: "€700 - €950", s: "€1,100 - €1,800" },
            "Serbia": { u: "€500 - €750", s: "€900 - €1,500" },
            "Macedonia": { u: "€450 - €700", s: "€800 - €1,400" },
            "Albania": { u: "€400 - €650", s: "€700 - €1,200" }
        };

        const jobMasterList = [
            // --- UNSKILLED ---
            {r:"Agriculture Farm Supervisor",type:"U",c:"Croatia"},{r:"Agriculture Farm Workers",type:"U",c:"Serbia"},
            {r:"Agriculture Worker",type:"U",c:"Poland"},{r:"Assembly Operator",type:"U",c:"Poland"},
            {r:"Assembly Worker",type:"U",c:"Macedonia"},{r:"Assistant Chef",type:"U",c:"Finland"},
            {r:"Assistant Cook",type:"U",c:"Finland"},{r:"Cleaner",type:"U",c:"Finland"},
            {r:"Cleaning Helper",type:"U",c:"Finland"},{r:"Construction Helper",type:"U",c:"Czech Republic"},
            {r:"Construction Worker",type:"U",c:"Croatia"},{r:"Dairy Farm Worker",type:"U",c:"Croatia"},
            {r:"Delivery Driver",type:"U",c:"Serbia"},{r:"Dishwasher",type:"U",c:"Finland"},
            {r:"Egg Packer",type:"U",c:"Poland"},{r:"Factory Worker",type:"U",c:"Poland"},
            {r:"Farm Worker",type:"U",c:"Albania"},{r:"Food Packing Worker",type:"U",c:"Poland"},
            {r:"General Laborer",type:"U",c:"Poland"},{r:"Harvesting Worker",type:"U",c:"Poland"},
            {r:"Housekeeping Worker",type:"U",c:"Finland"},{r:"Kitchen Helper",type:"U",c:"Finland"},
            {r:"Laundry Worker",type:"U",c:"Finland"},{r:"Loading Unloading Workers",type:"U",c:"Sweden"},
            {r:"Packaging Staff",type:"U",c:"Poland"},{r:"Packing Helper",type:"U",c:"Finland"},
            {r:"Production Line Worker",type:"U",c:"Czech Republic"},{r:"Store Keeper",type:"U",c:"Sweden"},
            {r:"Warehouse Staff",type:"U",c:"Serbia"},{r:"Warehouse Packer",type:"U",c:"Latvia"},

            // --- SKILLED ---
            {r:"Accountant",type:"S",c:"Netherlands"},{r:"Administrative Assistant",type:"S",c:"Netherlands"},
            {r:"Agriculture Farm Supervisor",type:"S",c:"Croatia"},{r:"Agriculture Farm Workers",type:"S",c:"Serbia"},
            {r:"Agriculture Field Officer",type:"S",c:"Netherlands"},{r:"Agriculture Pharmacist Technician",type:"S",c:"Netherlands"},
            {r:"Agriculture Worker",type:"S",c:"Poland"},{r:"Agriculture Workers",type:"S",c:"Serbia"},
            {r:"Air Conditioning Technician",type:"S",c:"Croatia"},{r:"Aircraft Cleaning Worker",type:"S",c:"Sweden"},
            {r:"Aircraft Mechanic",type:"S",c:"Latvia"},{r:"Alarm Technician",type:"S",c:"Sweden"},
            {r:"Ambulance Driver",type:"S",c:"Sweden"},{r:"Assembly Operator",type:"S",c:"Poland"},
            {r:"Assembly Worker",type:"S",c:"Macedonia"},{r:"Assistant Chef",type:"S",c:"Finland"},
            {r:"Assistant Cook",type:"S",c:"Finland"},{r:"Assistant Laboratory Technician",type:"S",c:"Sweden"},
            {r:"Assistant Nurse",type:"S",c:"Sweden"},{r:"Assistant Pharmacist",type:"S",c:"Sweden"},
            {r:"Auto Air Conditioning Technician",type:"S",c:"Czech Republic"},{r:"Auto Electrician",type:"S",c:"Czech Republic"},
            {r:"Auto Spray Painter",type:"S",c:"Czech Republic"},{r:"Automotive Mechanic",type:"S",c:"Serbia"},
            {r:"Automotive Technician",type:"S",c:"Czech Republic"},{r:"Baker/Pastry Chef",type:"S",c:"Finland"},
            {r:"Bank Assistant / Finance Executive",type:"S",c:"Germany"},{r:"Bar Supervisor",type:"S",c:"Finland"},
            {r:"Barista",type:"S",c:"Finland"},{r:"Bartender / Barman",type:"S",c:"Finland"},
            {r:"Battery Mechanic",type:"S",c:"Poland"},{r:"Bricklayer / Mason",type:"S",c:"Latvia"},
            {r:"Business Development",type:"S",c:"Italy"},{r:"Business Development Executive",type:"S",c:"Netherlands"},
            {r:"Butcher",type:"S",c:"Croatia"},{r:"CCTV Technician",type:"S",c:"Sweden"},
            {r:"CNC Operator",type:"S",c:"Czech Republic"},{r:"Call Centre Executive",type:"S",c:"Netherlands"},
            {r:"Cam Supervisor",type:"S",c:"Finland"},{r:"Captain",type:"S",c:"Finland"},
            {r:"Captain (ship/flight related)",type:"S",c:"Finland"},{r:"Care Home Assistant",type:"S",c:"Italy"},
            {r:"Care Home Jobs",type:"S",c:"Germany"},{r:"Carpenter Joinery Furniture",type:"S",c:"Croatia"},
            {r:"Carpenter Shuttering",type:"S",c:"Croatia"},{r:"Cashier",type:"S",c:"Finland"},
            {r:"Cashier (Duty-Free)",type:"S",c:"Finland"},{r:"Catering Supervisor",type:"S",c:"Finland"},
            {r:"Certified Welder",type:"S",c:"Serbia"},{r:"Chapathi / Parotta Maker",type:"S",c:"Finland"},
            {r:"Chef / Cook",type:"S",c:"Macedonia"},{r:"Chef de Partie",type:"S",c:"Finland"},
            {r:"Chief Cook",type:"S",c:"Finland"},{r:"Chief Laboratory Technician",type:"S",c:"Sweden"},
            {r:"Chief Pharmacist",type:"S",c:"Sweden"},{r:"Civil Draughtsman",type:"S",c:"Sweden"},
            {r:"Civil Engineer",type:"S",c:"Sweden"},{r:"Civil Site Supervisor",type:"S",c:"Sweden"},
            {r:"Cleaning Helper",type:"S",c:"Finland"},{r:"Cleaning Jobs",type:"S",c:"Finland"},
            {r:"Commis Chef",type:"S",c:"Finland"},{r:"Commis I, II*",type:"S",c:"Finland"},
            {r:"Commis III",type:"S",c:"Finland"},{r:"Computer Operator",type:"S",c:"Sweden"},
            {r:"Concrete Mix Operator",type:"S",c:"Sweden"},{r:"Construction Helper",type:"S",c:"Czech Republic"},
            {r:"Construction Helpers",type:"S",c:"Czech Republic"},{r:"Construction Safety Engineer",type:"S",c:"Sweden"},
            {r:"Construction Safety Officer",type:"S",c:"Sweden"},{r:"Construction Worker",type:"S",c:"Croatia"},
            {r:"Continental Cook",type:"S",c:"Serbia"},{r:"Customer Service Executive",type:"S",c:"Netherlands"},
            {r:"Dairy Farm Supervisor",type:"S",c:"Netherlands"},{r:"Dairy Farm Worker",type:"S",c:"Croatia"},
            {r:"Data Entry Operator",type:"S",c:"Sweden"},{r:"Delivery Driver",type:"S",c:"Serbia"},
            {r:"Diesel / Petrol Mechanic",type:"S",c:"Sweden"},{r:"Diesel Mechanical Technician",type:"S",c:"Sweden"},
            {r:"Dishwasher",type:"S",c:"Finland"},{r:"Document Controller",type:"S",c:"Netherlands"},
            {r:"Dozer Operator",type:"S",c:"Sweden"},{r:"Driver Light Duty",type:"S",c:"Finland"},
            {r:"Egg Collector",type:"S",c:"Poland"},{r:"Egg Packer",type:"S",c:"Poland"},
            {r:"Elderly Care Staff",type:"S",c:"Italy"},{r:"Electrical Draughtsman",type:"S",c:"Sweden"},
            {r:"Electrical Engineer",type:"S",c:"Sweden"},{r:"Electrical Supervisor",type:"S",c:"Sweden"},
            {r:"Electrical Technician High Voltage",type:"S",c:"Sweden"},{r:"Electrician",type:"S",c:"Poland"},
            {r:"Electrician (Certified)",type:"S",c:"Latvia"},{r:"Engineer",type:"S",c:"Netherlands"},
            {r:"Engineer (Various Disciplines)",type:"S",c:"Netherlands"},{r:"Excavator Operator",type:"S",c:"Sweden"},
            {r:"F & B Supervisor",type:"S",c:"Finland"},{r:"Fabricator",type:"S",c:"Sweden"},
            {r:"Farm Worker",type:"S",c:"Albania"},{r:"Fire & Safety Officer",type:"S",c:"Sweden"},
            {r:"Fire Alarm Technician",type:"S",c:"Sweden"},{r:"Food & Beverage Staff",type:"S",c:"Finland"},
            {r:"Food & Beverage Supervisor",type:"S",c:"Finland"},{r:"Food Packing Worker",type:"S",c:"Poland"},
            {r:"Food Quality Inspection Officer",type:"S",c:"Finland"},{r:"Food Quality Inspector",type:"S",c:"Finland"},
            {r:"Food and Beverage",type:"S",c:"Finland"},{r:"Forklift Operator",type:"S",c:"Poland"},
            {r:"Front Office Executive",type:"S",c:"Netherlands"},{r:"Fuel Station Operator",type:"S",c:"Poland"},
            {r:"Fuel Station Worker",type:"S",c:"Poland"},{r:"General Laborer",type:"S",c:"Poland"},
            {r:"Generator Mechanic",type:"S",c:"Sweden"},{r:"Glass Cutter",type:"S",c:"Poland"},
            {r:"Grader Operator",type:"S",c:"Sweden"},{r:"Greenhouse Worker",type:"S",c:"Netherlands"},
            {r:"HR Assistant",type:"S",c:"Italy"},{r:"HR Assistant / Executive",type:"S",c:"Netherlands"},
            {r:"Hair Stylist (Barber)",type:"S",c:"Croatia"},{r:"Harvester Machine Mechanic",type:"S",c:"Poland"},
            {r:"Harvester Machine Operator",type:"S",c:"Poland"},{r:"Harvesting Worker",type:"S",c:"Poland"},
            {r:"Head Chef",type:"S",c:"Finland"},{r:"Head Nurse",type:"S",c:"Sweden"},
            {r:"Health & Safety Officer",type:"S",c:"Finland"},{r:"Health and Safety Officer",type:"S",c:"Finland"},
            {r:"Healthcare Support",type:"S",c:"Italy"},{r:"Heavy Goods Driver (C+E)",type:"S",c:"Czech Republic"},
            {r:"Hospitality Staff",type:"S",c:"Serbia"},{r:"Hotel & Hospitality Jobs",type:"S",c:"Macedonia"},
            {r:"Hotel Staff",type:"S",c:"Macedonia"},{r:"Housekeeping Supervisor",type:"S",c:"Finland"},
            {r:"Housekeeping Worker",type:"S",c:"Finland"},{r:"Hydraulic Mechanic",type:"S",c:"Sweden"},
            {r:"IT Professional",type:"S",c:"Germany"},{r:"IT Systems Analyst",type:"S",c:"Latvia"},
            {r:"Inventory Clerk",type:"S",c:"Poland"},{r:"Juice Maker",type:"S",c:"Finland"},
            {r:"Kitchen Helper",type:"S",c:"Finland"},{r:"Land Surveyor",type:"S",c:"Sweden"},
            {r:"Laundry Supervisor",type:"S",c:"Finland"},{r:"Laundry Worker",type:"S",c:"Finland"},
            {r:"Lift Technician",type:"S",c:"Sweden"},{r:"Liner",type:"S",c:"Sweden"},
            {r:"Loading Unloading Workers",type:"S",c:"Sweden"},{r:"Loading/Unloading Worker",type:"S",c:"Sweden"},
            {r:"Logistics Coordinator",type:"S",c:"Netherlands"},{r:"Machine Operator",type:"S",c:"Poland"},
            {r:"Manager",type:"S",c:"Italy"},{r:"Mason",type:"S",c:"Macedonia"},
            {r:"Mason / Plasterer",type:"S",c:"Poland"},{r:"Mason Plaster / Tiles",type:"S",c:"Poland"},
            {r:"Mechanical Draughtsman",type:"S",c:"Sweden"},{r:"Mechanical Engineer",type:"S",c:"Sweden"},
            {r:"Mechanical Supervisor",type:"S",c:"Sweden"},{r:"Mobile Crane Operator",type:"S",c:"Sweden"},
            {r:"Nursing Assistant",type:"S",c:"France"},{r:"Office Assistant",type:"S",c:"Finland"},
            {r:"Office Clerk",type:"S",c:"Italy"},{r:"Office Clerk / Receptionist",type:"S",c:"Netherlands"},
            {r:"Packaging Staff",type:"S",c:"Poland"},{r:"Packing Helper",type:"S",c:"Finland"},
            {r:"Pastry Chef",type:"S",c:"Finland"},{r:"Picker / Packer",type:"S",c:"Poland"},
            {r:"Pizza Chef",type:"S",c:"Finland"},{r:"Pizza Makers",type:"S",c:"Finland"},
            {r:"Plumber",type:"S",c:"Macedonia"},{r:"Poultry Farm Hand",type:"S",c:"Poland"},
            {r:"Poultry Farm Supervisor",type:"S",c:"Poland"},{r:"Poultry Farm Worker",type:"S",c:"Poland"},
            {r:"Poultry Yard Cleaner",type:"S",c:"Poland"},{r:"Procurement / Purchase Assistant",type:"S",c:"Germany"},
            {r:"Production Line Worker",type:"S",c:"Czech Republic"},{r:"Professional Cook",type:"S",c:"Serbia"},
            {r:"Project Coordinator",type:"S",c:"Netherlands"},{r:"Pump Motor Mechanic",type:"S",c:"Sweden"},
            {r:"Quality Control (QC)",type:"S",c:"Poland"},{r:"RCC Fitter",type:"S",c:"Sweden"},
            {r:"RO Water Technician",type:"S",c:"Poland"},{r:"Radiology X-Ray Technician",type:"S",c:"Sweden"},
            {r:"Restaurant Supervisor",type:"S",c:"Finland"},{r:"Roller Operator",type:"S",c:"Sweden"},
            {r:"Safety Engineer",type:"S",c:"Sweden"},{r:"Sales & Marketing Exec",type:"S",c:"Italy"},
            {r:"Sales & Marketing Executive",type:"S",c:"Netherlands"},{r:"Sales Supervisor",type:"S",c:"Finland"},
            {r:"Sales Workers",type:"S",c:"Finland"},{r:"Sales Workers (Duty-Free)",type:"S",c:"Finland"},
            {r:"Scaffolder",type:"S",c:"Poland"},{r:"Secretary / Personal Assistant",type:"S",c:"Netherlands"},
            {r:"Security Guard",type:"S",c:"Finland"},{r:"Software Developer",type:"S",c:"Latvia"},
            {r:"Sous Chef",type:"S",c:"Finland"},{r:"Specialist Doctor",type:"S",c:"Latvia"},
            {r:"Spray Painter",type:"S",c:"Czech Republic"},{r:"Sprayer Mechanic",type:"S",c:"Poland"},
            {r:"Sprayer Operator",type:"S",c:"Poland"},{r:"Staff Bus Driver / Heavy Duty",type:"S",c:"Sweden"},
            {r:"Staff Bus Driver Head Duty",type:"S",c:"Finland"},{r:"Steel Fixer",type:"S",c:"Sweden"},
            {r:"Steward",type:"S",c:"Finland"},{r:"Steward Supervisor",type:"S",c:"Finland"},
            {r:"Stewards",type:"S",c:"Finland"},{r:"Store Keeper",type:"S",c:"Sweden"},
            {r:"Store Supervisor",type:"S",c:"Netherlands"},{r:"Sweeper",type:"S",c:"Sweden"},
            {r:"System Engineer",type:"S",c:"Finland"},{r:"System Operator",type:"S",c:"Finland"},
            {r:"System Service Engineer",type:"S",c:"Sweden"},{r:"TV Mechanic",type:"S",c:"Poland"},
            {r:"Tailor",type:"S",c:"Croatia"},{r:"Tailor Cutting Master",type:"S",c:"Croatia"},
            {r:"Tanker Driver / Heavy Duty",type:"S",c:"Sweden"},{r:"Tanker Driver Head Duty",type:"S",c:"Finland"},
            {r:"Time Keeper",type:"S",c:"Finland"},{r:"Tinker",type:"S",c:"Poland"},
            {r:"Tinker/Welder",type:"S",c:"Poland"},{r:"Tire Man",type:"S",c:"Poland"},
            {r:"Tower Crane Operator",type:"S",c:"Sweden"},{r:"Tractor Driver",type:"S",c:"Poland"},
            {r:"Transport Supervisor",type:"S",c:"Finland"},{r:"Trolley Helper",type:"S",c:"Sweden"},
            {r:"Truck Driver",type:"S",c:"Serbia"},{r:"Truck Driver (Code 95)",type:"S",c:"Latvia"},
            {r:"Veterinary Pharmacist",type:"S",c:"Poland"},{r:"Veterinary Technician",type:"S",c:"Poland"},
            {r:"Waiter",type:"S",c:"Finland"},{r:"Waiter/Waitress",type:"S",c:"Finland"},
            {r:"Wall Painter",type:"S",c:"Sweden"},{r:"Ward Assistant",type:"S",c:"Sweden"},
            {r:"Warehouse & Factory Workers",type:"S",c:"Serbia"},{r:"Warehouse Assistant",type:"S",c:"Poland"},
            {r:"Warehouse Packer",type:"S",c:"Latvia"},{r:"Warehouse Staff",type:"S",c:"Serbia"},
            {r:"Water Service Station Helper",type:"S",c:"Poland"},{r:"Welder",type:"S",c:"Macedonia"},
            {r:"Welder (Certified)",type:"S",c:"Poland"},{r:"Welder / Fitter",type:"S",c:"Latvia"},
            {r:"Workshop Helper",type:"S",c:"Poland"}
        ];

        const stateData = {
            "INDIA": ["Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal", "Delhi", "Chandigarh"],
            "PAKISTAN": ["Punjab", "Sindh", "Khyber Pakhtunkhwa", "Balochistan", "Islamabad", "Gilgit-Baltistan", "Azad Kashmir"],
            "NEPAL": ["Province 1", "Madhesh", "Bagmati", "Gandaki", "Lumbini", "Karnali", "Sudurpashchim"],
            "SRILANKA": ["Central", "Eastern", "North Central", "Northern", "North Western", "Sabaragamuwa", "Southern", "Uva", "Western"],
            "BANGLADESH": ["Barisal", "Chittagong", "Dhaka", "Khulna", "Mymensingh", "Rajshahi", "Rangpur", "Sylhet"],
            "PHILIPPINES": ["Metro Manila", "Cordillera (CAR)", "Ilocos", "Cagayan Valley", "Central Luzon", "Calabarzon", "Mimaropa", "Bicol", "Western Visayas", "Central Visayas", "Eastern Visayas", "Zamboanga", "Northern Mindanao", "Davao", "Soccsksargen", "Caraga", "Bangsamoro"],
            "EGYPT": ["Cairo", "Alexandria", "Giza", "Dakahlia", "Red Sea", "Beheira", "Faiyum", "Gharbia", "Ismailia", "Menofia", "Minya", "Qalyubia", "New Valley", "Sharqia", "Suez", "Aswan", "Assiut", "Beni Suef", "Port Said", "Damietta", "Kafr El Sheikh", "Matrouh", "Luxor", "Qena", "North Sinai", "South Sinai", "Sohag"],
            "AFRICA": ["Lagos (Nigeria)", "Abuja (Nigeria)", "Kano (Nigeria)", "Gauteng (SA)", "Western Cape (SA)", "Nairobi (Kenya)", "Accra (Ghana)", "Addis Ababa (Ethiopia)", "Cairo (Egypt)", "Casablanca (Morocco)", "Other"]
        };
        
        // --- NEW PHONE RULES (STRICT REGEX) ---
        const countryRules = {
            "INDIA": { regex: /^(\+91[- ]?)?[6-9]\d{9}$/, hint: "+91 9876543210" },
            "PAKISTAN": { regex: /^(\+92[- ]?)?3\d{2}[- ]?\d{7}$/, hint: "+92 300 1234567" },
            "NEPAL": { regex: /^(\+977[- ]?)?(98|97)\d{8}$/, hint: "+977 9812345678" },
            "SRILANKA": { regex: /^(\+94[- ]?)?7\d{8}$/, hint: "+94 77 1234567" },
            "BANGLADESH": { regex: /^(\+880[- ]?)?1\d{9}$/, hint: "+880 1712345678" },
            "PHILIPPINES": { regex: /^(\+63[- ]?)?9\d{9}$/, hint: "+63 912 345 6789" },
            "EGYPT": { regex: /^(\+20[- ]?)?1(0|1|2|5)\d{8}$/, hint: "+20 10 1234 5678" },
            "AFRICA": { regex: /^\+?\d{10,15}$/, hint: "+234..." },
            "OTHER": { regex: /^\+?\d{8,15}$/, hint: "+" }
        };

        const countryPageMap = {
            "Croatia": "croatia",
            "Czech Republic": "czech",
            "Albania": "albania",
            "Finland": "finland",
            "France": "france",
            "Germany": "germany",
            "Italy": "italy",
            "Latvia": "latvia",
            "Macedonia": "macedonia",
            "Netherlands": "netherlands",
            "Poland": "poland",
            "Sweden": "sweden",
            "Serbia": "serbia"
        };

        let currentMode = 'Unskilled';
        let currentPhoneRegex = null;

        // INIT
        window.onload = function() {
            setSkillMode('Unskilled'); 
            setupListeners();
            // Generate Random Case ID
            const rId = Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('refId').innerText = rId;
            document.getElementById('barcodeRef').innerText = "*" + rId + "*";
            
            // Helper to print Custom Field IDs for user to copy
            getClickUpFields();

            flatpickr("#dob", {
                dateFormat: "d/m/Y",
                disableMobile: false, 
                theme: "dark",
                onChange: function(selectedDates) {
                    if(selectedDates.length > 0) {
                        const age = new Date(Date.now() - selectedDates[0].getTime()).getUTCFullYear() - 1970;
                        const el = document.getElementById('age');
                        el.value = age;
                        if(age < 20) {
                            el.classList.add('border-red-500');
                            document.getElementById('ageError').classList.remove('hidden');
                        } else {
                            el.classList.remove('border-red-500');
                            document.getElementById('ageError').classList.add('hidden');
                        }
                    }
                }
            });
            
            flatpickr("#passportExp", {
                dateFormat: "d/m/Y",
                disableMobile: false, 
                theme: "dark"
            });
            
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('customJobSelect');
                const list = document.getElementById('jobDropdownList');
                if (dropdown && !dropdown.contains(event.target)) {
                    list.classList.add('hidden');
                    document.getElementById('jobDropdownIcon').classList.remove('rotate-180');
                }
            });
            
            // Trigger initial country check
            handleNationalityChange();
        };

        function setupListeners() {
            document.getElementById('sameAsMobile').addEventListener('change', function() {
                if(this.checked) {
                    const m = document.getElementById('mobile');
                    const w = document.getElementById('whatsapp');
                    w.value = m.value;
                    validatePhone('whatsapp');
                }
            });
        }

        // --- NEW DROPDOWN & EXPERIENCE LOGIC ---

        function toggleJobDropdown(e) {
            const list = document.getElementById('jobDropdownList');
            const icon = document.getElementById('jobDropdownIcon');
            list.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        function selectJob(jobRole) {
            document.getElementById('currentJob').value = jobRole;
            document.getElementById('selectedJobText').innerText = jobRole;
            document.getElementById('selectedJobText').classList.remove('text-gray-400');
            document.getElementById('selectedJobText').classList.add('text-white');
            
            // Close dropdown
            document.getElementById('jobDropdownList').classList.add('hidden');
            document.getElementById('jobDropdownIcon').classList.remove('rotate-180');
        }

        function populateDropdown(mode) {
            const listContainer = document.getElementById('jobDropdownList');
            listContainer.innerHTML = ''; // Clear existing
            
            const typeCode = mode === 'Unskilled' ? 'U' : 'S';
            const roles = jobMasterList.filter(j => j.type === typeCode).map(j => j.r).sort();
            
            if(roles.length === 0) {
                listContainer.innerHTML = '<div class="px-4 py-3 text-sm text-gray-500">No roles available</div>';
                return;
            }

            roles.forEach(r => {
                const div = document.createElement('div');
                div.className = "px-5 py-4 text-sm text-gray-300 hover:bg-brand-primary/20 hover:text-white cursor-pointer border-b border-white/5 last:border-0 transition-colors font-medium";
                div.innerText = r;
                div.onclick = function() { selectJob(r); };
                listContainer.appendChild(div);
            });
            
            // Reset selection display
            document.getElementById('currentJob').value = "";
            document.getElementById('selectedJobText').innerText = "Select Role";
            document.getElementById('selectedJobText').classList.add('text-gray-400');
        }

        function validateExperienceInput(el) {
            let val = parseInt(el.value);
            if(isNaN(val) || val < 1) el.value = 1;
            else if(val > 30) el.value = 30;
        }

        // --- CUSTOM MODAL LOGIC ---
        function showModal(msg) {
            const m = document.getElementById('messageModal');
            document.getElementById('modalText').innerText = msg;
            m.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                m.classList.remove('opacity-0');
                m.querySelector('.modal-content').classList.remove('scale-90');
                m.querySelector('.modal-content').classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const m = document.getElementById('messageModal');
            m.classList.add('opacity-0');
            m.querySelector('.modal-content').classList.add('scale-90');
            m.querySelector('.modal-content').classList.remove('scale-100');
            setTimeout(() => {
                m.classList.add('hidden');
            }, 300);
        }

        // ----------------------------------------

        // GEOGRAPHY & VALIDATION LOGIC
        function handleNationalityChange() {
            const sel = document.getElementById('nationality');
            const country = sel.value;
            const code = sel.options[sel.selectedIndex].getAttribute('data-code');
            
            // Set Global Rules
            const rule = countryRules[country] || countryRules["OTHER"];
            currentPhoneRegex = rule.regex;

            const mob = document.getElementById('mobile');
            const wa = document.getElementById('whatsapp');
            
            // Only set placeholder or value if empty to avoid annoying user
            if(mob.value === "") mob.value = code + " ";
            if(wa.value === "") wa.value = code + " ";
            mob.placeholder = rule.hint;
            wa.placeholder = rule.hint;
            
            document.getElementById('mobileError').classList.add('hidden');
            mob.classList.remove('invalid-field', 'valid-field');
            document.getElementById('mobileFeedback').innerHTML = '';

            const stateWrap = document.getElementById('stateInputWrapper');
            const states = stateData[country];
            if(states) {
                let h = `<select id="state" required class="geo-input w-full rounded-xl px-5 py-4 uppercase font-bold appearance-none"><option value="">SELECT STATE / PROVINCE</option>`;
                states.forEach(s => h += `<option value="${s}">${s}</option>`);
                h += `</select><div class="absolute right-5 top-1/2 -translate-y-1/2 text-brand-gold pointer-events-none"><i class="fa-solid fa-chevron-down"></i></div>`;
                stateWrap.innerHTML = h;
            } else {
                stateWrap.innerHTML = `<input type="text" id="state" required class="geo-input w-full rounded-xl px-5 py-4 placeholder-brand-gold/40 uppercase font-bold" placeholder="ENTER STATE">`;
            }
        }

        function cleanPhoneNumber(phoneStr) {
            if(!phoneStr) return null;
            // Remove all spaces, dashes, etc. Keep only + and digits for CLICKUP E.164
            // This fixes the saving error
            return phoneStr.replace(/[^0-9+]/g, '');
        }

        function validatePhone(id) {
            const el = document.getElementById(id);
            const feedback = id === 'mobile' ? document.getElementById('mobileFeedback') : document.getElementById('waFeedback');
            const errorMsg = document.getElementById('mobileError');
            
            const rawVal = el.value.trim();

            if (!currentPhoneRegex) {
                 // Fallback
                 el.classList.remove('invalid-field');
                 return;
            }

            // TEST REGEX
            const isValid = currentPhoneRegex.test(rawVal);

            if (isValid) {
                el.classList.remove('invalid-field');
                el.classList.add('valid-field');
                feedback.innerHTML = '<i class="fa-solid fa-circle-check text-[#00ff88] drop-shadow-[0_0_5px_rgba(0,255,136,0.5)]"></i>';
                if(id==='mobile') errorMsg.classList.add('hidden');
            } else {
                el.classList.remove('valid-field');
                // Only show error style if length is substantial to avoid red box while typing first char
                if(rawVal.length > 4) {
                    el.classList.add('invalid-field');
                    feedback.innerHTML = '<i class="fa-solid fa-circle-xmark text-[#ff0055]"></i>';
                } else {
                     feedback.innerHTML = '';
                }
            }
        }

        function goToStep2() {
            const age = parseInt(document.getElementById('age').value);
            // UPDATED: Age eligibility logic (20-50)
            if(isNaN(age) || age < 20 || age > 50) { 
                const ageField = document.getElementById('age');
                ageField.classList.add('invalid-field', 'animate-pulse');
                setTimeout(() => ageField.classList.remove('animate-pulse'), 500);
                showModal("Sorry, you are not eligible for the immigration process. (Age requirement: 20-50)"); 
                return; 
            }
            
            // STRICT PHONE VALIDATION CHECK BEFORE NEXT
            const mEl = document.getElementById('mobile');
            const rawVal = mEl.value.trim();
            if(currentPhoneRegex && !currentPhoneRegex.test(rawVal)) {
                mEl.classList.add('invalid-field');
                const btn = document.getElementById('nextBtn');
                btn.classList.add('animate-shake');
                setTimeout(() => btn.classList.remove('animate-shake'), 500);
                document.getElementById('mobileError').classList.remove('hidden');
                
                const sel = document.getElementById('nationality');
                const rule = countryRules[sel.value] || countryRules["OTHER"];
                showModal(`Invalid Mobile Number Format.\n\nExample format for ${sel.options[sel.selectedIndex].text}: ${rule.hint}`);
                return;
            }

            if(!document.getElementById('personalForm').checkValidity()) {
                document.getElementById('personalForm').reportValidity(); return;
            }

            document.getElementById('tab-1').classList.add('hidden');
            document.getElementById('tab-2').classList.remove('hidden');
            
            // Visual Update for Steps
            const s1 = document.getElementById('step-1-indicator');
            const s2 = document.getElementById('step-2-indicator');
            s1.classList.add('opacity-50', 'grayscale');
            s2.classList.remove('opacity-50', 'grayscale');
            s2.querySelector('div').classList.add('border-brand-primary', 'shadow-neon-blue', 'text-brand-primary');
            s2.querySelector('div').classList.remove('border-white/20', 'text-white');
            s2.querySelector('span').classList.add('text-brand-primary', 'text-shadow-glow');

            const name = document.getElementById('firstName').value + " " + document.getElementById('lastName').value;
            document.getElementById('reportName').innerText = name;
            document.getElementById('avatarInitial').innerText = name.charAt(0);
            
            const today = new Date();
            document.getElementById('reportDate').innerText = today.toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function setSkillMode(mode) {
            currentMode = mode;
            const uCard = document.getElementById('cardUnskilled');
            const sCard = document.getElementById('cardSkilled');
            const uCheck = document.getElementById('checkUnskilled');
            const sCheck = document.getElementById('checkSkilled');
            const jobPanel = document.getElementById('jobDetailsPanel');
            const expWrap = document.getElementById('experienceWrapper');

            uCard.classList.remove('active'); sCard.classList.remove('active');
            uCheck.querySelector('div').classList.add('hidden');
            sCheck.querySelector('div').classList.add('hidden');
            uCheck.className = "w-8 h-8 rounded-full border-2 border-gray-600 flex items-center justify-center transition-all";
            sCheck.className = "w-8 h-8 rounded-full border-2 border-gray-600 flex items-center justify-center transition-all";

            if (mode === 'Unskilled') {
                uCard.classList.add('active');
                uCheck.className = "w-8 h-8 rounded-full border-brand-primary flex items-center justify-center bg-brand-primary/20 shadow-neon-blue";
                uCheck.querySelector('div').classList.remove('hidden');
                expWrap.classList.add('hidden');
            } else {
                sCard.classList.add('active');
                sCheck.className = "w-8 h-8 rounded-full border-brand-secondary flex items-center justify-center bg-brand-secondary/20 shadow-[0_0_15px_rgba(112,0,255,0.4)]";
                sCheck.querySelector('div').classList.remove('hidden');
                expWrap.classList.remove('hidden');
            }

            jobPanel.classList.remove('hidden');
            populateDropdown(mode); 
            document.getElementById('reportContainer').classList.add('hidden');
        }

        function getSalary(countryCode, skillType) {
            // Helper to safe-get salary or return default
            const key = skillType === 'Unskilled' ? 'u' : 's';
            // Need to match country names from jobMasterList with salaryDb keys
            // Simple direct match for now
            const data = salaryDb[countryCode];
            if(data) return data[key] + " / Month";
            return "€800 - €2,000 / Month"; // Fallback
        }

        function generateReport() {
            const role = document.getElementById('currentJob').value;
            if(!role) { showModal("Please select a target position to continue."); return; }

            const expEl = document.getElementById('experience');
            if(currentMode === 'Skilled') {
                let val = parseInt(expEl.value);
                if(isNaN(val) || val < 1) { showModal("Minimum 1 year of professional experience is required for Skilled Migration."); return; }
                if(val > 30) { showModal("Experience cannot exceed 30 years."); return; }
            }

            // Get Qualification
            const qual = document.querySelector('input[name="qualification"]:checked').value;

            document.getElementById('reportContainer').classList.remove('hidden');
            setTimeout(() => { document.getElementById('reportContainer').scrollIntoView({ behavior: 'smooth' }); }, 100);

            const jobData = jobMasterList.find(j => j.r === role);
            
            // Populate Data
            document.getElementById('topMatchRole').innerText = role;
            document.getElementById('topMatchCountry').innerText = jobData.c;
            document.getElementById('reportRole').innerText = role;
            document.getElementById('reportQualification').innerText = qual;
            
            // SALARY POPULATION
            const salaryText = getSalary(jobData.c, currentMode);
            document.getElementById('mainSalaryRange').innerText = salaryText;

            // UPDATE MAIN BUTTON LINK
            const mainBtn = document.getElementById('mainActionBtn');
            const targetPage = countryPageMap[jobData.c];
            const targetUrl = targetPage ? targetPage : 'https://bettercallimmigration.com/appointment';
            mainBtn.onclick = function() {
                 window.open(targetUrl, '_blank');
            };
            
            // Generate Expert Text
            const reasoning = document.getElementById('aiReasoning');
            let exp = "0";
            if(currentMode === 'Unskilled') {
                reasoning.innerText = `Based on current labor shortages in the ${jobData.c} general labor market, candidates applying for ${role} have a high success rate. No specific experience verification is typically required for this visa category, making it an excellent entry-level pathway for global mobility.`;
                document.getElementById('reportExp').innerText = "Entry Level";
            } else {
                exp = document.getElementById('experience').value;
                reasoning.innerText = `With ${exp} years of specialized experience as a ${role}, you meet the skilled migration criteria for ${jobData.c}. This pathway offers long-term residency options for qualified professionals in your sector, with high demand noted in major industrial regions.`;
                document.getElementById('reportExp').innerText = exp + " Years";
            }

            // Generate Alternatives
            const grid = document.getElementById('altMatchesGrid');
            grid.innerHTML = '';
            const others = jobMasterList.filter(j => j.type === jobData.type && j.c !== jobData.c).sort(() => 0.5 - Math.random()).slice(0, 3);
            others.forEach(o => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-white/5 p-4 rounded-2xl border border-white/5 hover:bg-white/10 hover:border-brand-primary/30 transition-all cursor-pointer group";
                
                const altTargetPage = countryPageMap[o.c];
                const altTargetUrl = altTargetPage ? altTargetPage : 'https://bettercallimmigration.com/appointment';
                div.onclick = function() { window.open(altTargetUrl, '_blank'); };

                // Get Alt Salary
                const altSal = getSalary(o.c, currentMode);

                div.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-black/40 flex items-center justify-center text-xl shadow-inner border border-white/5">${getFlag(o.c)}</div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-center">
                                <div class="text-sm font-bold text-gray-200 group-hover:text-white transition tracking-wide">${o.c}</div>
                                <div class="text-[10px] text-green-400 font-bold bg-green-900/20 px-2 py-0.5 rounded">${altSal}</div>
                            </div>
                            <div class="text-[10px] text-gray-500 uppercase">${o.r}</div>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-700 text-xs group-hover:text-brand-primary transition-colors ml-2"></i>
                `;
                grid.appendChild(div);
            });

            // saveData() is called here
            saveData();
        }

        function getFlag(c) {
            const m = { "Sweden": "🇸🇪", "Finland": "🇫🇮", "Netherlands": "🇳🇱", "Germany": "🇩🇪", "Czech Republic": "🇨🇿", "Poland": "🇵🇱", "France": "🇫🇷", "Italy": "🇮🇹", "Latvia": "🇱🇻", "Croatia": "🇭🇷", "Serbia": "🇷🇸", "Albania": "🇦🇱", "Macedonia": "🇲🇰" };
            return m[c] || "🇪🇺";
        }

        // UPDATED: Download Record Feature (CSV EXCEL COMPATIBLE)
        function downloadRecord() {
            // 1. Gather all data points
            const ref = document.getElementById('refId').innerText;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const dob = document.getElementById('dob').value;
            const age = document.getElementById('age').value;
            const nationality = document.getElementById('nationality').value;
            
            // Handle State (might be input or select)
            const stateEl = document.getElementById('state');
            const state = stateEl ? stateEl.value : '';

            const mobile = document.getElementById('mobile').value;
            const whatsapp = document.getElementById('whatsapp').value;
            
            // Radio button for qualification
            const qualEl = document.querySelector('input[name="qualification"]:checked');
            const qualification = qualEl ? qualEl.value : '';

            const passportNo = document.getElementById('passportNo').value;
            const passportExp = document.getElementById('passportExp').value;
            
            const role = document.getElementById('currentJob').value;
            const exp = document.getElementById('experience').value;
            const type = currentMode; // Variable from wider scope
            const country = document.getElementById('topMatchCountry').innerText;
            const date = new Date().toLocaleDateString();

            // 2. Create CSV Content (Excel compatible)
            // BOM for Excel to read UTF-8 correctly
            const bom = "\uFEFF"; 
            const headers = ["Ref ID", "First Name", "Last Name", "DOB", "Age", "Nationality", "State", "Mobile", "WhatsApp", "Qualification", "Passport No", "Passport Exp", "Role", "Experience", "Type", "Target Country", "Date"];
            const values = [ref, firstName, lastName, dob, age, nationality, state, mobile, whatsapp, qualification, passportNo, passportExp, role, exp, type, country, date];

            // Helper to escape commas in data
            const escapeCsv = (str) => `"${String(str).replace(/"/g, '""')}"`;
            
            const csvContent = bom + headers.join(",") + "\n" + values.map(escapeCsv).join(",");

            // 3. Trigger Download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Assessment_${ref}_FullData.csv`; // Changed extension to .csv
            document.body.appendChild(a); // Append for Firefox support
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Helper to convert date string DD/MM/YYYY to Unix Timestamp (ms) for ClickUp
        function getUnixTime(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                // new Date(year, monthIndex, day)
                const dt = new Date(parts[2], parts[1] - 1, parts[0]);
                const ts = dt.getTime();
                return isNaN(ts) ? null : ts;
            }
            return null;
        }

        // HELPER TO FETCH FIELD IDS FOR USER
        async function getClickUpFields() {
            if(!CLICKUP_API_KEY || CLICKUP_API_KEY.length < 10) return;
            console.log("%c Fetching ClickUp Fields... ", "background: #222; color: #bada55");
            
            try {
                const res = await fetch(`https://api.clickup.com/api/v2/list/${CLICKUP_LIST_ID}/field`, {
                    method: 'GET',
                    headers: { 'Authorization': CLICKUP_API_KEY }
                });
                const data = await res.json();
                
                if(data.fields) {
                    console.group("YOUR CLICKUP FIELD IDs (Copy these into the code!)");
                    data.fields.forEach(f => {
                        console.log(`"${f.name}": "${f.id}",  // Type: ${f.type}`);
                    });
                    console.groupEnd();
                }
            } catch(e) { console.error("Could not fetch fields", e); }
        }

        async function saveData() {
            // 1. Gather all data points
            const ref = document.getElementById('refId').innerText;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const dob = document.getElementById('dob').value;
            const age = parseInt(document.getElementById('age').value) || 0;
            const nationality = document.getElementById('nationality').value;
            const state = document.getElementById('state') ? document.getElementById('state').value : '';
            
            // Clean phone numbers: REMOVE SPACES/DASHES FOR CLICKUP SAVING
            const mobile = cleanPhoneNumber(document.getElementById('mobile').value);
            const whatsapp = cleanPhoneNumber(document.getElementById('whatsapp').value);
            
            const qualification = document.querySelector('input[name="qualification"]:checked')?.value || '';
            const passportNo = document.getElementById('passportNo').value;
            const passportExp = document.getElementById('passportExp').value;
            const role = document.getElementById('currentJob').value;
            const exp = parseInt(document.getElementById('experience').value) || 0;
            const resultCountry = document.getElementById('topMatchCountry').innerText;

            // 2. Prepare Custom Fields Array for ClickUp
            const customFieldsArray = [];

            // FETCH OPTION IDS FOR DROPDOWNS
            let fieldDefinitions = [];
            try {
                const res = await fetch(`https://api.clickup.com/api/v2/list/${CLICKUP_LIST_ID}/field`, {
                    method: 'GET',
                    headers: { 'Authorization': CLICKUP_API_KEY }
                });
                const data = await res.json();
                fieldDefinitions = data.fields;
            } catch (e) {
                console.error("Failed to fetch field definitions for Dropdown mapping", e);
            }

            // Helper to find Option UUID by Text (Case Insensitive)
            const getOptionId = (fieldId, textValue) => {
                if (!fieldDefinitions || !textValue) return null;
                const field = fieldDefinitions.find(f => f.id === fieldId);
                if (!field || !field.type_config || !field.type_config.options) return null;
                
                const option = field.type_config.options.find(o => o.name && o.name.toLowerCase() === textValue.toLowerCase());
                return option ? option.id : null; // Return UUID or null
            };

            // Helper to push only if ID exists in config
            const addField = (key, val, isDropdown = false) => {
                if (CLICKUP_FIELDS[key] && val !== null && val !== "") {
                    let finalValue = val;
                    
                    if (isDropdown) {
                        const optionId = getOptionId(CLICKUP_FIELDS[key], val);
                        if (optionId !== null) {
                             const field = fieldDefinitions.find(f => f.id === CLICKUP_FIELDS[key]);
                             const index = field.type_config.options.findIndex(o => o.id === optionId);
                             if(index > -1) finalValue = index; 
                        } else {
                           console.warn(`ClickUp Dropdown Mismatch: '${val}' not found in field '${key}'. Skipping to prevent error.`);
                           return; 
                        }
                    }
                    
                    customFieldsArray.push({ "id": CLICKUP_FIELDS[key], "value": finalValue });
                }
            };

            // Map Data to Configured IDs
            addField("SUR NAME", lastName);
            addField("MOBILE", mobile);
            addField("WHATSAPP", whatsapp);
            addField("DATE OF BIRTH", getUnixTime(dob));
            addField("AGE", age);
            
            // Dropdowns (Pass true as 3rd argument)
            addField("QUALIFICATION", qualification, true); 
            addField("PROFESSION", role, true);             
            addField("NATIONALITY", nationality, true);     
            
            addField("STATE", state);
            addField("EXPERIENCE", exp);
            addField("PASSPORT NUMBER", passportNo);
            addField("PASSPORT EXPIRY", getUnixTime(passportExp));
            addField("Case Reference ID", ref);
            
            console.log("Saving to ClickUp Payload:", customFieldsArray);

            // 3. Send to ClickUp
            if(CLICKUP_API_KEY && CLICKUP_LIST_ID && !CLICKUP_API_KEY.includes("pk_12345")) {
                
                // --- FULL DESCRIPTION LOGIC RESTORED HERE ---
                const fullDescription = `**FULL CANDIDATE PROFILE**
--------------------------------------------------
**CASE REFERENCE:** ${ref}
**DATE:** ${new Date().toLocaleDateString()}

**PERSONAL DETAILS**
--------------------------------------------------
**First Name:** ${firstName}
**Last Name:** ${lastName}
**Date of Birth:** ${dob}
**Age:** ${age}
**Nationality:** ${nationality}
**State/Province:** ${state}

**CONTACT INFO**
--------------------------------------------------
**Mobile:** ${mobile}
**WhatsApp:** ${whatsapp}

**PROFESSIONAL PROFILE**
--------------------------------------------------
**Target Role:** ${role}
**Category:** ${currentMode}
**Experience:** ${exp} Years
**Qualification:** ${qualification}

**TRAVEL DOCS**
--------------------------------------------------
**Passport No:** ${passportNo || "N/A"}
**Expiry:** ${passportExp || "N/A"}

**ASSESSMENT RESULT**
--------------------------------------------------
**Primary Recommendation:** ${resultCountry}
**Est. Salary:** ${getSalary(resultCountry, currentMode)}

--------------------------------------------------
*Verified by Better Call Immigration AI*`;

                const clickUpPayload = {
                    name: firstName, 
                    description: fullDescription, 
                    custom_fields: customFieldsArray
                };

                try {
                    const res = await fetch(`https://api.clickup.com/api/v2/list/${CLICKUP_LIST_ID}/task`, {
                        method: 'POST',
                        headers: { 'Authorization': CLICKUP_API_KEY, 'Content-Type': 'application/json' },
                        body: JSON.stringify(clickUpPayload)
                    });

                    if(!res.ok) {
                        const err = await res.json();
                        console.error("ClickUp Error", err);
                    } else {
                        console.log("Saved to ClickUp!");
                    }
                } catch(e) { 
                    console.error("ClickUp Connection Error", e);
                }
            } else {
                console.log("ClickUp Integration: Key not configured.");
            }

            // 4. Show Toast
            showToast();
        }

        function showToast() {
            const t = document.getElementById('toast');
            t.classList.remove('translate-y-32','opacity-0');
            setTimeout(() => t.classList.add('translate-y-32','opacity-0'), 3000);
        }
    </script>
</body>
</html>