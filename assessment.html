<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Career Assessment | Better Call Immigration</title>
    <meta name="description" content="AI-Powered Career Assessment for Global Migration">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Barcode Font for Authenticity -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Flatpickr (Stylish Date Picker - Light Theme) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/airbnb.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Tailwind CSS (Warning Suppressed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning for cleaner console
        console.warn = function() {}; 

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#ffffff',
                        'brand-primary': '#2563eb', /* Royal Blue */
                        'brand-secondary': '#7c3aed', /* Vibrant Violet */
                        'brand-accent': '#f43f5e', /* Rose */
                        'brand-gold': '#d97706', /* Amber */
                        'glass-surface': 'rgba(255, 255, 255, 0.65)',
                        'glass-border': 'rgba(255, 255, 255, 0.4)',
                        'glass-highlight': 'rgba(255, 255, 255, 0.8)',
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        barcode: ['"Libre Barcode 39 Text"', 'cursive'],
                    },
                    boxShadow: {
                        'soft-xl': '0 20px 40px -10px rgba(0, 0, 0, 0.08)',
                        'soft-inner': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.02)',
                        'glow-primary': '0 0 20px rgba(37, 99, 235, 0.2)',
                        'glass-lg': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    },
                    animation: {
                        'blob': 'blob 15s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up-fade': 'slideUpFade 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        slideUpFade: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        popIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE & BACKGROUND */
        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        /* Ambient Orbs Background (Vibrant Light Theme) */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, #f0f9ff 0%, #eef2ff 100%);
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: blob 25s infinite alternate;
        }
        .orb-1 { width: 800px; height: 800px; background: #e0e7ff; top: -200px; left: -200px; animation-delay: 0s; mix-blend-mode: multiply;}
        .orb-2 { width: 600px; height: 600px; background: #dbeafe; bottom: -100px; right: -100px; animation-delay: -5s; mix-blend-mode: multiply;}
        .orb-3 { width: 500px; height: 500px; background: #fae8ff; top: 30%; right: 20%; animation-delay: -10s; opacity: 0.5; mix-blend-mode: multiply;}

        /* GLASSMORPHISM PANEL (Clean Pro) */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.05), inset 0 0 0 1px rgba(255, 255, 255, 0.5);
            position: relative;
        }

        /* INPUTS (Clean White - Uniform) */
        .form-input, .date-input-container, .geo-input {
            height: 3.5rem; /* Uniform Height */
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #1e293b;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            border-radius: 0.75rem;
            width: 100%;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
        }
        .form-input::placeholder, .date-input-container input::placeholder { color: #94a3b8; font-weight: 400; }
        
        .form-input:hover, .date-input-container:hover, .geo-input:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
        }
        .form-input:focus, .geo-input:focus {
            border-color: #2563eb;
            background: #ffffff;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            outline: none;
        }

        /* Specific Date Input Fixes */
        .date-input-container {
            display: flex;
            align-items: center;
            overflow: hidden;
            padding: 0;
        }
        .date-input-container:hover { border-color: #cbd5e1; }
        .date-input-container:focus-within {
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }
        .date-icon-box {
            padding: 0 1.25rem;
            color: #7c3aed;
            background: #f5f3ff;
            height: 100%;
            display: flex;
            align-items: center;
            border-right: 1px solid #ede9fe;
        }
        .date-input-container input {
            background: transparent;
            border: none;
            color: #1e293b;
            width: 100%;
            padding: 0 1rem;
            height: 100%;
            outline: none;
            font-weight: 600;
        }

        /* DROPDOWN ARROW FIX */
        select.geo-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        /* UTILS */
        .uppercase-input { text-transform: uppercase; }
        .valid-field { border-color: #10b981 !important; background-color: #ecfdf5 !important; }
        .invalid-field { border-color: #f43f5e !important; background-color: #fff1f2 !important; }

        /* CATEGORY CARDS */
        .category-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.08);
            border-color: #2563eb;
        }
        .category-card.active {
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
            border-color: #2563eb;
            box-shadow: 0 10px 30px -5px rgba(37, 99, 235, 0.15);
            position: relative;
        }
        .category-card.active::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 1.5rem;
            border: 2px solid #2563eb;
            pointer-events: none;
        }

        /* DROPDOWN SCROLLBAR */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* BUTTON GRADIENTS */
        .btn-gradient {
            background-size: 200% auto;
            background-image: linear-gradient(to right, #2563eb 0%, #7c3aed 51%, #2563eb 100%);
            transition: 0.5s;
        }
        .btn-gradient:hover { background-position: right center; box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4); }

        /* CUSTOM MODAL */
        #messageModal { backdrop-filter: blur(8px); }
        .modal-content {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        
        /* FILE UPLOAD ZONE */
        .upload-zone {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            background-color: #eff6ff;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%232563EB' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Ambient Background -->
    <div class="ambient-light">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Header -->
    <nav class="fixed w-full z-50 transition-all duration-300 backdrop-blur-md bg-white/70 border-b border-gray-100/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-brand-primary/20 animate-float">
                        <i class="fa-solid fa-plane-departure transform -rotate-12"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-2xl tracking-tight text-slate-900">Better Call <span class="text-brand-primary">Immigration</span></h1>
                        <p class="text-[10px] text-slate-500 uppercase tracking-[0.2em] font-semibold">Global Assessment Portal</p>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-32 pb-12 px-4 relative z-10">
        <div class="max-w-6xl mx-auto">
            
            <!-- Progress Steps (Clean Nodes) -->
            <div class="mb-16 relative">
                <!-- Connecting Line -->
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-0.5 bg-gray-200"></div>
                
                <div class="flex items-center justify-center gap-16 relative z-10">
                    <!-- Step 1 -->
                    <div id="step-1-indicator" class="flex flex-col items-center gap-3 transition-all duration-500">
                        <div class="w-12 h-12 rounded-full bg-white border-4 border-brand-primary shadow-lg flex items-center justify-center text-brand-primary text-lg font-bold">1</div>
                        <span class="font-bold text-sm text-brand-primary tracking-widest uppercase">Profile</span>
                    </div>
                    
                    <!-- Step 2 -->
                    <div id="step-2-indicator" class="flex flex-col items-center gap-3 transition-all duration-500 opacity-40 grayscale">
                        <div class="w-12 h-12 rounded-full bg-white border-4 border-gray-200 flex items-center justify-center text-gray-400 text-lg font-bold">2</div>
                        <span class="font-bold text-sm text-gray-400 tracking-widest uppercase">Report</span>
                    </div>
                </div>
            </div>

            <!-- TAB 1: Personal Details -->
            <div id="tab-1" class="glass-panel rounded-3xl p-8 md:p-12 animate-slide-up-fade max-w-4xl mx-auto">
                <div class="mb-10 text-center">
                    <h2 class="text-4xl font-black text-slate-900 mb-3 tracking-tight">Begin Your Journey</h2>
                    <p class="text-slate-500 text-sm tracking-wide font-medium">Enter details as per your official documents.</p>
                </div>

                <form id="personalForm" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Name & Surname -->
                    <div class="group">
                        <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Given Name</label>
                        <input type="text" id="firstName" required class="form-input uppercase-input px-5 text-lg" placeholder="JOHN" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="group">
                        <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Surname</label>
                        <input type="text" id="lastName" required class="form-input uppercase-input px-5 text-lg" placeholder="DOE" oninput="this.value = this.value.toUpperCase()">
                    </div>

                    <!-- Email Address -->
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">Email Address</label>
                        <div class="relative">
                            <input type="email" id="email" required class="form-input pl-12 text-lg font-semibold" placeholder="name@example.com">
                            <i class="fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                        </div>
                    </div>

                    <!-- Date of Birth -->
                    <div>
                        <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">
                            <i class="fa-regular fa-calendar-days mr-1"></i> Date of Birth
                        </label>
                        <div class="date-input-container rounded-xl">
                            <div class="date-icon-box"><i class="fa-solid fa-cake-candles"></i></div>
                            <input type="text" id="dob" required placeholder="Select Date" class="text-lg font-medium">
                        </div>
                    </div>
                    
                    <!-- Age (Readonly) -->
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">Age</label>
                        <input type="text" id="age" readonly class="form-input w-full rounded-xl px-5 py-4 bg-gray-50 text-slate-500 cursor-not-allowed font-mono font-bold">
                        <p id="ageError" class="text-brand-accent text-[11px] hidden mt-2 font-bold flex items-center gap-2 animate-pulse"><i class="fa-solid fa-triangle-exclamation"></i> Must be 20+ years.</p>
                    </div>

                    <!-- GEOGRAPHY SECTION (Gold Styled - Modern) -->
                    <div class="md:col-span-2 relative p-8 rounded-2xl border border-brand-gold/20 bg-gradient-to-br from-amber-50 to-white overflow-hidden shadow-sm">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10">
                            
                            <!-- Present Residence (Moved First) -->
                            <div>
                                <label class="block text-xs font-black text-brand-gold uppercase tracking-widest mb-3 ml-1">
                                    <i class="fa-solid fa-location-dot mr-1"></i> Present Residence
                                </label>
                                <div class="relative">
                                    <select id="presentResidence" required class="geo-input w-full rounded-xl px-5 py-4 font-bold uppercase appearance-none" onchange="handleResidenceChange()">
                                        <option value="">Select Residence</option>
                                        <!-- JS Populated - Will set 'UAE' via script -->
                                    </select>
                                    <div class="absolute right-5 top-1/2 -translate-y-1/2 text-brand-gold pointer-events-none"><i class="fa-solid fa-chevron-down"></i></div>
                                </div>
                            </div>

                            <!-- Nationality -->
                            <div>
                                <label class="block text-xs font-black text-brand-gold uppercase tracking-widest mb-3 ml-1">
                                    <i class="fa-solid fa-earth-americas mr-1"></i> Nationality
                                </label>
                                <div class="relative">
                                    <select id="nationality" required class="geo-input w-full rounded-xl px-5 py-4 font-bold uppercase appearance-none">
                                        <option value="">Select Origin</option>
                                        <!-- JS Populated -->
                                    </select>
                                    <div class="absolute right-5 top-1/2 -translate-y-1/2 text-brand-gold pointer-events-none"><i class="fa-solid fa-chevron-down"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">Mobile</label>
                        <div class="relative group">
                            <input type="tel" id="mobile" required class="form-input w-full rounded-xl px-5 py-4 pl-12 font-mono text-lg font-semibold" placeholder="+..." oninput="enforcePhoneInput(this); validatePhone('mobile')">
                            <i class="fa-solid fa-phone absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-primary transition-colors"></i>
                            <div id="mobileFeedback" class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold"></div>
                        </div>
                        <p id="mobileHint" class="text-xs text-brand-primary mt-2 pl-1 font-mono font-medium opacity-0 transition-opacity">Format: </p>
                        <p id="mobileError" class="text-brand-accent text-[11px] hidden mt-2 pl-1 font-bold">Invalid Format.</p>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">WhatsApp</label>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="sameAsMobile" class="w-4 h-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary cursor-pointer">
                                <label for="sameAsMobile" class="text-[10px] text-slate-500 cursor-pointer select-none font-bold uppercase tracking-wider">Same as Mobile</label>
                            </div>
                        </div>
                        <div class="relative group">
                            <input type="tel" id="whatsapp" required class="form-input w-full rounded-xl px-5 py-4 pl-12 font-mono text-lg font-semibold" placeholder="+..." oninput="enforcePhoneInput(this); validatePhone('whatsapp')">
                            <i class="fa-brands fa-whatsapp absolute left-4 top-1/2 -translate-y-1/2 text-green-500 opacity-60 group-focus-within:opacity-100 transition-opacity"></i>
                            <div id="waFeedback" class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold"></div>
                        </div>
                        <p id="waHint" class="text-xs text-brand-secondary mt-2 pl-1 font-mono font-medium opacity-0 transition-opacity">Format: </p>
                    </div>

                    <!-- NEW ALTERNATIVE PHONE FIELD -->
                    <div class="md:col-span-2">
                         <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">Alternative Phone (Optional)</label>
                         <div class="relative group">
                            <input type="tel" id="altPhone" class="form-input w-full rounded-xl px-5 py-4 pl-12 font-mono text-lg font-semibold" placeholder="+..." oninput="enforcePhoneInput(this); validatePhone('altPhone')">
                            <i class="fa-solid fa-phone-volume absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-gold transition-colors"></i>
                            <div id="altPhoneFeedback" class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold"></div>
                        </div>
                    </div>

                    <!-- Qualifications -->
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-1">Education Level</label>
                        <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                            <!-- Helper for cleaner HTML repetition -->
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="UNDER 10 TH" class="peer sr-only" required>
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-school text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">Under 10th</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="SCHOOL" class="peer sr-only">
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-book-open text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">School</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="PLUS TWO" class="peer sr-only">
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-graduation-cap text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">Plus Two</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="DIPLOMA" class="peer sr-only">
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-scroll text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">Diploma</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="BACHELOR" class="peer sr-only">
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-user-graduate text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">Bachelor</span>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="qualification" value="MASTER" class="peer sr-only">
                                <div class="h-full rounded-xl border border-gray-200 bg-white p-4 flex flex-col items-center justify-center text-center gap-2 hover:border-brand-primary/50 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-brand-primary peer-checked:shadow-md transition-all">
                                    <i class="fa-solid fa-medal text-xl text-slate-400 peer-checked:text-brand-primary group-hover:scale-110 transition-transform"></i>
                                    <span class="text-[10px] font-bold text-slate-500 peer-checked:text-brand-primary">Master</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Passport -->
                     <div class="md:col-span-1">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">Passport No. (Optional)</label>
                        <input type="text" id="passportNo" class="form-input uppercase-input w-full rounded-xl px-5 py-4 font-mono font-medium" placeholder="X1234567" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="md:col-span-1">
                        <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">
                             <i class="fa-solid fa-passport mr-1"></i> Passport Expiry
                        </label>
                        <div class="date-input-container rounded-xl">
                            <div class="date-icon-box"><i class="fa-solid fa-hourglass-half"></i></div>
                            <input type="text" id="passportExp" placeholder="Select Date" class="text-lg font-medium">
                        </div>
                    </div>

                    <!-- NEW CV UPLOAD SECTION -->
                    <div class="md:col-span-2 mt-4 bg-gradient-to-br from-white to-blue-50/50 rounded-2xl border border-blue-100 p-6 shadow-sm relative overflow-hidden">
                        <!-- Decorative bg elem -->
                        <div class="absolute top-0 right-0 -mt-10 -mr-10 w-32 h-32 bg-brand-primary/5 rounded-full blur-2xl pointer-events-none"></div>

                        <label class="block text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-file-circle-question text-brand-primary"></i>
                            Do you have a CV / Resume for better assessment?
                        </label>
                        
                        <div class="flex gap-6 mb-4 relative z-10">
                            <!-- Default to YES -->
                            <label class="flex items-center gap-2 cursor-pointer group">
                                <input type="radio" name="hasCv" value="yes" class="peer sr-only" onchange="toggleCvUpload(true)" checked>
                                <div class="px-6 py-2 rounded-full border border-gray-200 bg-white text-slate-500 font-bold peer-checked:bg-brand-primary peer-checked:text-white peer-checked:border-brand-primary peer-checked:shadow-lg transition-all shadow-sm group-hover:border-brand-primary/40">Yes</div>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer group">
                                <input type="radio" name="hasCv" value="no" class="peer sr-only" onchange="toggleCvUpload(false)">
                                <div class="px-6 py-2 rounded-full border border-gray-200 bg-white text-slate-500 font-bold peer-checked:bg-brand-secondary peer-checked:text-white peer-checked:border-brand-secondary peer-checked:shadow-lg transition-all shadow-sm group-hover:border-brand-secondary/40">No</div>
                            </label>
                        </div>
                        
                        <!-- Default to visible -->
                        <div id="cvUploadContainer" class="animate-pop-in relative z-10">
                            <div class="upload-zone rounded-xl p-8 text-center cursor-pointer relative group">
                                <input type="file" id="cvFile" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" accept=".pdf,.doc,.docx" onchange="handleFileSelect(this)">
                                
                                <div class="transition-transform duration-300 group-hover:-translate-y-1">
                                    <div class="w-12 h-12 rounded-full bg-white text-brand-primary shadow-md flex items-center justify-center mx-auto mb-3 text-xl group-hover:text-white group-hover:bg-brand-primary transition-colors">
                                        <i class="fa-solid fa-cloud-arrow-up"></i>
                                    </div>
                                    <p class="text-sm font-bold text-slate-700" id="fileNameDisplay">Tap here to upload CV</p>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">PDF, DOC, DOCX (Max 5MB)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="md:col-span-2 mt-8 flex justify-end">
                        <button type="button" onclick="goToStep2()" id="nextBtn" class="btn-gradient text-white font-bold py-4 px-12 rounded-xl shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 flex items-center gap-3">
                            <span class="tracking-wider">NEXT STEP</span>
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- TAB 2: AI Job Report -->
            <div id="tab-2" class="hidden animate-slide-up-fade">
                <!-- 1. CATEGORY SELECTOR -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 max-w-4xl mx-auto">
                    <!-- UNSKILLED OPTION -->
                    <div id="cardUnskilled" onclick="setSkillMode('Unskilled')" class="category-card rounded-3xl p-8 flex items-center gap-6 cursor-pointer relative overflow-hidden">
                        <div class="w-16 h-16 rounded-2xl bg-blue-50 text-brand-primary flex items-center justify-center text-3xl shadow-sm">
                            <i class="fa-solid fa-hands-holding-circle"></i>
                        </div>
                        <div class="z-10">
                            <h3 class="text-xl font-bold text-slate-800 mb-1">General / Unskilled</h3>
                            <p class="text-xs text-slate-500 tracking-wide font-medium">Factory, Agriculture, Warehouse</p>
                        </div>
                        <div class="ml-auto z-10">
                            <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all" id="checkUnskilled">
                                <div class="w-4 h-4 rounded-full bg-brand-primary hidden shadow-lg"></div>
                            </div>
                        </div>
                    </div>
                    <!-- SKILLED OPTION -->
                    <div id="cardSkilled" onclick="setSkillMode('Skilled')" class="category-card rounded-3xl p-8 flex items-center gap-6 cursor-pointer relative overflow-hidden">
                        <div class="w-16 h-16 rounded-2xl bg-purple-50 text-brand-secondary flex items-center justify-center text-3xl shadow-sm">
                            <i class="fa-solid fa-user-tie"></i>
                        </div>
                        <div class="z-10">
                            <h3 class="text-xl font-bold text-slate-800 mb-1">Skilled Professional</h3>
                            <p class="text-xs text-slate-500 tracking-wide font-medium">Engineer, IT, Medical, Trades</p>
                        </div>
                        <div class="ml-auto z-10">
                            <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all" id="checkSkilled">
                                <div class="w-4 h-4 rounded-full bg-brand-secondary hidden shadow-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. JOB DETAILS FORM -->
                <div id="jobDetailsPanel" class="glass-panel rounded-3xl p-8 mb-12 hidden animate-pop-in relative z-20 max-w-4xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-end">
                        
                        <!-- STYLISH DROP DOWN -->
                        <div class="relative group" id="customJobSelect">
                            <label class="block text-xs font-bold text-brand-primary uppercase tracking-widest mb-3 ml-1">Job Role</label>
                            
                            <!-- Trigger -->
                            <button type="button" class="form-input w-full text-left rounded-xl px-5 py-4 flex justify-between items-center cursor-pointer" onclick="toggleJobDropdown(event)">
                                <span id="selectedJobText" class="text-slate-500 font-medium">Select Job Role</span>
                                <i class="fa-solid fa-chevron-up transition-transform duration-300 text-brand-primary" id="jobDropdownIcon"></i>
                            </button>

                            <!-- Drop Down List -->
                            <div id="jobDropdownList" class="hidden absolute top-full left-0 w-full mt-2 bg-white border border-gray-200 rounded-2xl shadow-xl max-h-80 overflow-y-auto z-50 custom-scrollbar transform origin-top transition-all duration-300">
                                <!-- JS Injected -->
                            </div>
                            
                            <input type="hidden" id="currentJob">
                        </div>

                        <!-- EXPERIENCE -->
                        <div id="experienceWrapper" class="hidden animate-pop-in">
                            <label class="block text-xs font-bold text-brand-secondary uppercase tracking-widest mb-3 ml-1">Years of Experience</label>
                            <div class="relative">
                                <input type="number" id="experience" min="1" max="30" value="1" class="form-input w-full rounded-xl px-5 py-4 font-bold text-lg" placeholder="Min 1" onblur="validateExperienceInput(this)">
                                <div class="absolute right-5 top-1/2 -translate-y-1/2 text-xs text-brand-secondary font-black tracking-widest">YEARS</div>
                            </div>
                        </div>

                        <div class="md:col-span-2 flex justify-end mt-4">
                             <button type="button" onclick="generateReport()" class="w-full md:w-auto btn-gradient text-white font-bold py-4 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 flex items-center justify-center gap-3 group">
                                <i class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition-transform"></i> 
                                <span>GENERATE ANALYSIS</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 3. REPORT DASHBOARD (Redesigned Professional Reality) -->
                <div id="reportContainer" class="hidden max-w-5xl mx-auto">
                    <div class="glass-panel p-1 rounded-3xl animate-slide-up-fade">
                        <div class="bg-white rounded-[22px] p-8 md:p-12 relative overflow-hidden shadow-sm">
                             <!-- Top decorative bar -->
                             <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-primary to-brand-secondary"></div>

                             <!-- Header Section -->
                             <div class="flex flex-col md:flex-row justify-between items-start md:items-end border-b border-gray-100 pb-8 mb-8 gap-6">
                                <div>
                                    <div class="flex items-center gap-3 mb-2">
                                         <div class="w-8 h-8 rounded bg-blue-50 text-brand-primary flex items-center justify-center">
                                            <i class="fa-solid fa-layer-group"></i>
                                         </div>
                                         <span class="text-xs font-bold text-slate-400 tracking-widest uppercase">Immigration Strategy Unit</span>
                                    </div>
                                    <h2 class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight">Assessment Report</h2>
                                    <p class="text-sm text-slate-500 font-medium mt-1">AI-Generated Analysis for Global Mobility</p>
                                </div>
                                <div class="text-left md:text-right">
                                    <div class="font-barcode text-4xl text-slate-300 mb-1" id="barcodeRef"></div>
                                    <div class="text-xs font-mono text-slate-400">REF: <span id="refId" class="text-slate-600 font-bold"></span></div>
                                    <div class="text-xs font-mono text-slate-400">DATE: <span id="reportDate"></span></div>
                                </div>
                             </div>

                             <!-- Candidate Profile Grid (No Overlap - Professional Layout) -->
                             <div class="bg-slate-50 rounded-2xl p-6 mb-10 border border-gray-100">
                                <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-start">
                                    <!-- Avatar -->
                                    <div class="md:col-span-2 flex justify-center md:justify-start">
                                        <div class="w-20 h-20 rounded-2xl bg-white shadow-sm border border-gray-100 flex items-center justify-center text-3xl font-bold text-brand-primary" id="avatarInitial"></div>
                                    </div>
                                    
                                    <!-- Details -->
                                    <div class="md:col-span-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                        <div class="overflow-hidden">
                                            <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-1">Candidate</p>
                                            <h3 class="text-lg font-bold text-slate-900 leading-tight break-words" id="reportName"></h3>
                                        </div>
                                        <div class="overflow-hidden">
                                             <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-1">Job Role</p>
                                             <div class="text-sm font-semibold text-brand-primary leading-tight break-words" id="reportRole"></div>
                                        </div>
                                        <div class="overflow-hidden">
                                             <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-1">Qualification</p>
                                             <div class="text-sm font-semibold text-slate-700 leading-tight break-words" id="reportQualification"></div>
                                        </div>
                                         <div class="overflow-hidden">
                                             <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-1">Experience</p>
                                             <div class="text-sm font-bold text-slate-900" id="reportExp"></div>
                                        </div>
                                    </div>
                                </div>
                             </div>

                             <!-- Main Recommendation Area -->
                             <div class="flex flex-col lg:flex-row gap-8">
                                <!-- Left: The Country Match -->
                                <div class="lg:w-2/3">
                                    <div class="h-full rounded-2xl border border-gray-200 bg-white shadow-sm p-1 relative overflow-hidden group">
                                        <div class="absolute top-0 right-0 w-32 h-32 bg-brand-primary/5 rounded-full blur-3xl -mr-10 -mt-10"></div>
                                        
                                        <div class="p-6 md:p-8 relative z-10">
                                            <div class="flex items-center justify-between mb-6">
                                                <span class="bg-green-50 text-green-600 border border-green-100 text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider flex items-center gap-2">
                                                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Top Recommendation
                                                </span>
                                                <i class="fa-solid fa-medal text-brand-gold text-2xl"></i>
                                            </div>
                                            
                                            <h2 class="text-5xl font-black text-slate-900 mb-2 tracking-tight" id="topMatchCountry"></h2>
                                            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-slate-500 mb-8">
                                                <span class="flex items-center gap-2"><i class="fa-solid fa-briefcase text-brand-primary"></i> <span id="topMatchRole_2"></span></span>
                                                <span class="hidden sm:inline text-gray-300">|</span>
                                                <span class="flex items-center gap-2 text-slate-700 font-bold"><i class="fa-solid fa-wallet text-brand-secondary"></i> <span id="mainSalaryRange"></span></span>
                                            </div>

                                            <!-- Metrics Bar (Replacing Circular Gauge) -->
                                            <div class="bg-slate-50 rounded-xl p-5 border border-gray-100 mb-6">
                                                <div class="flex justify-between items-end mb-2">
                                                    <span class="text-xs font-bold text-slate-700">Match Probability</span>
                                                    <span class="text-xl font-black text-brand-primary">98%</span>
                                                </div>
                                                <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                                    <div class="h-full bg-gradient-to-r from-brand-primary to-brand-secondary w-[98%] rounded-full shadow-[0_0_10px_rgba(37,99,235,0.3)]"></div>
                                                </div>
                                                <div class="flex justify-between mt-3 text-[10px] text-slate-400 font-medium uppercase tracking-wider">
                                                    <span>Visa: Work Permit (D-Type)</span>
                                                    <span>Processing: 3-5 Months</span>
                                                </div>
                                            </div>

                                            <div class="prose prose-sm text-slate-500 leading-relaxed">
                                                <p id="aiReasoning" class="italic border-l-4 border-brand-primary pl-4 py-1">AI Reasoning loading...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right: CTA & Alternatives -->
                                <div class="lg:w-1/3 flex flex-col gap-6">
                                     <!-- Alternatives List (Moved Up to be First) -->
                                    <div class="bg-white rounded-2xl border border-gray-100 p-6 shadow-sm order-1">
                                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Strategic Alternatives</h4>
                                        <div class="flex flex-col gap-3" id="altMatchesGrid">
                                             <!-- Items -->
                                        </div>
                                    </div>

                                     <!-- CTA (Moved Down to be Last & Creative Redesign) -->
                                    <div class="order-2 relative group overflow-hidden rounded-2xl p-8 text-white shadow-2xl shadow-blue-900/20 transition-all hover:shadow-blue-900/40 hover:-translate-y-1">
                                        <!-- Background with animated gradient -->
                                        <div class="absolute inset-0 bg-gradient-to-br from-slate-900 via-brand-primary/90 to-brand-secondary/90 transition-all duration-500 group-hover:scale-105"></div>
                                        
                                        <!-- Decorative Circles -->
                                        <div class="absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                                        <div class="absolute bottom-0 left-0 -ml-8 -mb-8 w-24 h-24 bg-brand-gold/20 rounded-full blur-xl"></div>

                                        <div class="relative z-10 flex flex-col items-center text-center">
                                            <div class="w-16 h-16 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center text-3xl mb-4 border border-white/20 shadow-inner">
                                                <i class="fa-solid fa-headset text-white animate-pulse"></i>
                                            </div>

                                            <h4 class="text-2xl font-black mb-2 tracking-tight">Expert Advice</h4>
                                            <p class="text-blue-50 text-sm font-medium mb-6 leading-relaxed opacity-90 px-2">
                                                Do you want to speak with our expert advice? Book your appointment.
                                            </p>

                                            <button id="mainActionBtn" class="w-full bg-white text-brand-primary font-black py-4 px-6 rounded-xl shadow-lg hover:shadow-xl hover:bg-blue-50 transition-all flex items-center justify-center gap-3 group/btn">
                                                <span class="tracking-wider text-sm">BOOK APPOINTMENT</span>
                                                <i class="fa-solid fa-calendar-check text-lg group-hover/btn:scale-110 transition-transform"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>
    
    <footer class="border-t border-gray-200/60 bg-white/50 py-8 mt-auto backdrop-blur-sm relative z-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-xs"> 2024 Better Call Immigration. Designed for the Future.</p>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-8 transform translate-y-32 opacity-0 transition-all duration-500 z-50">
        <div class="glass-panel border-l-4 border-brand-primary text-slate-800 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 bg-white">
            <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-brand-primary">
                <i class="fa-solid fa-check"></i>
            </div>
            <div>
                <h4 class="font-bold text-sm">Success</h4>
                <span class="text-xs text-slate-500" id="toastMsg">Assessment Saved Securely</span>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Errors (Replaces Alert) -->
    <div id="messageModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-slate-900/40 opacity-0 transition-opacity duration-300">
        <div class="modal-content w-full max-w-sm rounded-2xl p-6 transform scale-90 transition-transform duration-300 text-center">
            <div class="w-12 h-12 rounded-full bg-red-50 text-brand-accent flex items-center justify-center text-xl mx-auto mb-4">
                <i class="fa-solid fa-circle-exclamation"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-2">Attention Needed</h3>
            <p id="modalText" class="text-slate-500 text-sm mb-6">Please check your inputs.</p>
            <button onclick="closeModal()" class="w-full bg-brand-accent hover:bg-rose-600 text-white font-bold py-3 rounded-xl transition-all shadow-lg">
                UNDERSTOOD
            </button>
        </div>
    </div>

    <script>
        // Suppress Tailwind CDN warning for cleaner console
        console.warn = function() {}; 

        // ==========================================
        //  CONFIGURATION AREA
        // ==========================================
        
        const CLICKUP_API_KEY = "pk_260468481_DGN3UIQ1QIOC3C2V3M3UG9XFE8SCXXCH"; 
        const CLICKUP_LIST_ID = "901813907839"; 
        
        // ----------------------------------------------------
        //  CLICKUP CUSTOM FIELD IDs
        //  Updated with specific IDs from user log.
        // ----------------------------------------------------
        const CLICKUP_FIELDS = {
            "SUR NAME": "34d446a2-fe50-45bc-8e3b-64660ebdd6f7",  
            "MOBILE": "5693724c-ee50-469b-a4a9-3848fe6d3115", 
            "WHATSAPP": "87b4eee7-444f-4ec4-9882-441965757a68", 
            "PHONE": "8efe7c3f-70cc-46d4-b6db-1324e5071b29", // Alternative Phone
            "DATE OF BIRTH": "72d7dec6-eb69-4d1d-b5ea-af6e99d28a38",    
            "AGE": "f4ba427f-6e9c-4aa2-ae5c-8159e1254d2c",    
            "QUALIFICATION": "2cd34df4-98b5-4c82-8d86-a34bf3c1618b",
            "JOB ROLE": "5e3fdff6-e1ea-4ca3-8ce5-190f2ce09082", // Updated Field ID from Log
            "NATIONALITY": "e79e1c4e-b123-4bd9-8051-34859ea4b87e", 
            "EXPERIENCE": "267d8fd1-cc80-4343-972a-4a1d45cab5d7", 
            "PASSPORT NUMBER": "b8798515-8962-40a7-a8cd-2685f9fd676c",
            "PASSPORT EXPIRY": "5aa1bec5-f188-4ef7-8f7d-2b4778fbe738", 
            "Case Reference ID": "a25c1d42-6191-4fde-8eb4-7f2059fd71e3",
            "EMAIL": "2e18821e-1c19-4de5-afb8-77ff11ee6327", 
            "PRESENT RESIDENCE": "dbb3620a-3cc3-44c0-8a01-d92a1594d6f5" // Dropdown ID
        };

        // SALARY DATA
        const salaryDb = {
            "Netherlands": { u: "1,800 - 2,400", s: "3,200 - 4,500" },
            "Germany": { u: "1,600 - 2,200", s: "3,500 - 5,000" },
            "Sweden": { u: "1,700 - 2,300", s: "3,000 - 4,200" },
            "Finland": { u: "1,600 - 2,100", s: "2,800 - 4,000" },
            "France": { u: "1,500 - 1,900", s: "2,500 - 3,800" },
            "Italy": { u: "1,200 - 1,600", s: "2,000 - 3,000" },
            "Czech Republic": { u: "900 - 1,200", s: "1,500 - 2,500" },
            "Poland": { u: "800 - 1,100", s: "1,400 - 2,200" },
            "Croatia": { u: "700 - 1,000", s: "1,200 - 2,000" },
            "Latvia": { u: "700 - 950", s: "1,100 - 1,800" },
            "Serbia": { u: "500 - 750", s: "900 - 1,500" },
            "Macedonia": { u: "450 - 700", s: "800 - 1,400" },
            "Albania": { u: "400 - 650", s: "700 - 1,200" }
        };

        // LARGE JOB MASTER LIST WITH VALIDATION
        const jobMasterList = [
            {r:"ACCOUNTANT",type:"S",c:"Netherlands"},
            {r:"ADMINISTRATIVE ASSISTANT",type:"S",c:"Germany"},
            {r:"AGRICULTURE FARM SUPERVISOR",type:"S",c:"Finland"},
            {r:"AGRICULTURE FARM WORKERS",type:"U",c:"Poland"},
            {r:"AGRICULTURE FIELD OFFICER",type:"S",c:"Netherlands"},
            {r:"AGRICULTURE PHARMACIST TECHNICIAN",type:"S",c:"Netherlands"},
            {r:"AGRICULTURE WORKER",type:"U",c:"Croatia"},
            {r:"AGRICULTURE WORKERS",type:"U",c:"Serbia"},
            {r:"AIR CONDITIONING TECHNICIAN",type:"S",c:"Germany"},
            {r:"AIRCRAFT CLEANING WORKER",type:"U",c:"Sweden"},
            {r:"AIRCRAFT MECHANIC",type:"S",c:"Latvia"},
            {r:"ALARM TECHNICIAN",type:"S",c:"Sweden"},
            {r:"AMBULANCE DRIVER",type:"S",c:"Finland"},
            {r:"ASSEMBLY OPERATOR",type:"U",c:"Poland"},
            {r:"ASSEMBLY WORKER",type:"U",c:"Macedonia"},
            {r:"ASSISTANT CHEF",type:"U",c:"Finland"},
            {r:"ASSISTANT COOK",type:"U",c:"France"},
            {r:"ASSISTANT LABORATORY TECHNICIAN",type:"S",c:"Sweden"},
            {r:"ASSISTANT NURSE",type:"S",c:"Germany"},
            {r:"ASSISTANT PHARMACIST",type:"S",c:"Sweden"},
            {r:"AUTO AIR CONDITIONING TECHNICIAN",type:"S",c:"Czech Republic"},
            {r:"AUTO ELECTRICIAN",type:"S",c:"Czech Republic"},
            {r:"AUTO SPRAY PAINTER",type:"S",c:"Czech Republic"},
            {r:"AUTOMOTIVE MECHANIC",type:"S",c:"Serbia"},
            {r:"AUTOMOTIVE TECHNICIAN",type:"S",c:"Germany"},
            {r:"BAKER/PASTRY CHEF",type:"S",c:"France"},
            {r:"BANK ASSISTANT / FINANCE EXECUTIVE",type:"S",c:"Netherlands"},
            {r:"BAR SUPERVISOR",type:"S",c:"Finland"},
            {r:"BARISTA",type:"U",c:"Italy"},
            {r:"BARTENDER / BARMAN",type:"U",c:"Croatia"},
            {r:"BATTERY MECHANIC",type:"S",c:"Poland"},
            {r:"BRICKLAYER / MASON",type:"S",c:"Latvia"},
            {r:"BUSINESS DEVELOPMENT",type:"S",c:"Netherlands"},
            {r:"BUSINESS DEVELOPMENT EXECUTIVE",type:"S",c:"Germany"},
            {r:"BUTCHER",type:"S",c:"Poland"},
            {r:"CALL CENTRE EXECUTIVE",type:"S",c:"Latvia"},
            {r:"CAM SUPERVISOR",type:"S",c:"Finland"},
            {r:"CAPTAIN",type:"S",c:"Netherlands"},
            {r:"CAPTAIN (SHIP/FLIGHT RELATED)",type:"S",c:"Netherlands"},
            {r:"CARE HOME ASSISTANT",type:"U",c:"Germany"},
            {r:"CARE HOME JOBS",type:"U",c:"Germany"},
            {r:"CARPENTER JOINERY FURNITURE",type:"S",c:"Croatia"},
            {r:"CARPENTER SHUTTERING",type:"S",c:"Croatia"},
            {r:"CASHIER",type:"U",c:"Finland"},
            {r:"CASHIER (DUTY-FREE)",type:"U",c:"Finland"},
            {r:"CATERING SUPERVISOR",type:"S",c:"Sweden"},
            {r:"CCTV TECHNICIAN",type:"S",c:"Germany"},
            {r:"CERTIFIED WELDER",type:"S",c:"Poland"},
            {r:"CHAPATHI / PAROTTA MAKER",type:"U",c:"Finland"},
            {r:"CHEF / COOK",type:"S",c:"France"},
            {r:"CHEF DE PARTIE",type:"S",c:"Finland"},
            {r:"CHIEF COOK",type:"S",c:"France"},
            {r:"CHIEF LABORATORY TECHNICIAN",type:"S",c:"Sweden"},
            {r:"CHIEF PHARMACIST",type:"S",c:"Netherlands"},
            {r:"CIVIL DRAUGHTSMAN",type:"S",c:"Germany"},
            {r:"CIVIL ENGINEER",type:"S",c:"Sweden"},
            {r:"CIVIL SITE SUPERVISOR",type:"S",c:"Finland"},
            {r:"CLEANING HELPER",type:"U",c:"Finland"},
            {r:"CLEANING JOBS",type:"U",c:"Finland"},
            {r:"CNC OPERATOR",type:"S",c:"Czech Republic"},
            {r:"COMMIS CHEF",type:"U",c:"Finland"},
            {r:"COMMIS I, II",type:"U",c:"France"},
            {r:"COMMIS III",type:"U",c:"France"},
            {r:"COMPUTER OPERATOR",type:"S",c:"Latvia"},
            {r:"CONCRETE MIX OPERATOR",type:"S",c:"Croatia"},
            {r:"CONSTRUCTION HELPER",type:"U",c:"Croatia"},
            {r:"CONSTRUCTION HELPERS",type:"U",c:"Serbia"},
            {r:"CONSTRUCTION SAFETY ENGINEER",type:"S",c:"Sweden"},
            {r:"CONSTRUCTION SAFETY OFFICER",type:"S",c:"Germany"},
            {r:"CONSTRUCTION WORKER",type:"U",c:"Poland"},
            {r:"CONTINENTAL COOK",type:"S",c:"Finland"},
            {r:"CUSTOMER SERVICE EXECUTIVE",type:"S",c:"Latvia"},
            {r:"DAIRY FARM SUPERVISOR",type:"S",c:"Netherlands"},
            {r:"DAIRY FARM WORKER",type:"U",c:"Netherlands"},
            {r:"DATA ENTRY OPERATOR",type:"S",c:"Latvia"},
            {r:"DELIVERY DRIVER",type:"U",c:"Croatia"},
            {r:"DIESEL / PETROL MECHANIC",type:"S",c:"Germany"},
            {r:"DIESEL MECHANICAL TECHNICIAN",type:"S",c:"Sweden"},
            {r:"DISHWASHER",type:"U",c:"Finland"},
            {r:"DOCUMENT CONTROLLER",type:"S",c:"Netherlands"},
            {r:"DOZER OPERATOR",type:"S",c:"Serbia"},
            {r:"DRIVER LIGHT DUTY",type:"U",c:"Poland"},
            {r:"EGG COLLECTOR",type:"U",c:"Poland"},
            {r:"EGG PACKER",type:"U",c:"Poland"},
            {r:"ELDERLY CARE STAFF",type:"U",c:"Germany"},
            {r:"ELECTRICAL DRAUGHTSMAN",type:"S",c:"Sweden"},
            {r:"ELECTRICAL ENGINEER",type:"S",c:"Germany"},
            {r:"ELECTRICAL SUPERVISOR",type:"S",c:"Finland"},
            {r:"ELECTRICAL TECHNICIAN HIGH VOLTAGE",type:"S",c:"Sweden"},
            {r:"ELECTRICIAN",type:"S",c:"Poland"},
            {r:"ELECTRICIAN (CERTIFIED)",type:"S",c:"Latvia"},
            {r:"ENGINEER",type:"S",c:"Netherlands"},
            {r:"ENGINEER (VARIOUS DISCIPLINES)",type:"S",c:"Germany"},
            {r:"EXCAVATOR OPERATOR",type:"S",c:"Croatia"},
            {r:"F & B SUPERVISOR",type:"S",c:"Finland"},
            {r:"FABRICATOR",type:"S",c:"Czech Republic"},
            {r:"FARM WORKER",type:"U",c:"Albania"},
            {r:"FIRE & SAFETY OFFICER",type:"S",c:"Sweden"},
            {r:"FIRE ALARM TECHNICIAN",type:"S",c:"Finland"},
            {r:"FOOD & BEVERAGE STAFF",type:"U",c:"Croatia"},
            {r:"FOOD & BEVERAGE SUPERVISOR",type:"S",c:"Italy"},
            {r:"FOOD AND BEVERAGE",type:"U",c:"Serbia"},
            {r:"FOOD PACKING WORKER",type:"U",c:"Poland"},
            {r:"FOOD QUALITY INSPECTION OFFICER",type:"S",c:"Netherlands"},
            {r:"FOOD QUALITY INSPECTOR",type:"S",c:"Germany"},
            {r:"FORKLIFT OPERATOR",type:"S",c:"Poland"},
            {r:"FRONT OFFICE EXECUTIVE",type:"S",c:"Latvia"},
            {r:"FUEL STATION OPERATOR",type:"U",c:"Poland"},
            {r:"FUEL STATION WORKER",type:"U",c:"Latvia"},
            {r:"GENERAL LABORER",type:"U",c:"Croatia"},
            {r:"GENERATOR MECHANIC",type:"S",c:"Serbia"},
            {r:"GLASS CUTTER",type:"S",c:"Czech Republic"},
            {r:"GRADER OPERATOR",type:"S",c:"Poland"},
            {r:"GREENHOUSE WORKER",type:"U",c:"Netherlands"},
            {r:"HAIR STYLIST (BARBER)",type:"S",c:"Italy"},
            {r:"HARVESTER MACHINE MECHANIC",type:"S",c:"Germany"},
            {r:"HARVESTER MACHINE OPERATOR",type:"S",c:"Finland"},
            {r:"HARVESTING WORKER",type:"U",c:"Poland"},
            {r:"HEAD CHEF",type:"S",c:"France"},
            {r:"HEAD NURSE",type:"S",c:"Sweden"},
            {r:"HEALTH & SAFETY OFFICER",type:"S",c:"Netherlands"},
            {r:"HEALTH AND SAFETY OFFICER",type:"S",c:"Finland"},
            {r:"HEALTHCARE SUPPORT",type:"U",c:"Germany"},
            {r:"HEAVY GOODS DRIVER (C+E)",type:"S",c:"Poland"},
            {r:"HOSPITALITY STAFF",type:"U",c:"Croatia"},
            {r:"HOTEL & HOSPITALITY JOBS",type:"U",c:"Italy"},
            {r:"HOTEL STAFF",type:"U",c:"Macedonia"},
            {r:"HOUSEKEEPING SUPERVISOR",type:"S",c:"Finland"},
            {r:"HOUSEKEEPING WORKER",type:"U",c:"Sweden"},
            {r:"HR ASSISTANT",type:"S",c:"Latvia"},
            {r:"HR ASSISTANT / EXECUTIVE",type:"S",c:"Netherlands"},
            {r:"HYDRAULIC MECHANIC",type:"S",c:"Germany"},
            {r:"INVENTORY CLERK",type:"S",c:"Poland"},
            {r:"IT PROFESSIONAL",type:"S",c:"Germany"},
            {r:"IT SYSTEMS ANALYST",type:"S",c:"Sweden"},
            {r:"JUICE MAKER",type:"U",c:"Finland"},
            {r:"KITCHEN HELPER",type:"U",c:"France"},
            {r:"LAND SURVEYOR",type:"S",c:"Croatia"},
            {r:"LAUNDRY SUPERVISOR",type:"S",c:"Italy"},
            {r:"LAUNDRY WORKER",type:"U",c:"Latvia"},
            {r:"LIFT TECHNICIAN",type:"S",c:"Finland"},
            {r:"LINER",type:"S",c:"Sweden"},
            {r:"LOADING UNLOADING WORKERS",type:"U",c:"Poland"},
            {r:"LOADING/UNLOADING WORKER",type:"U",c:"Serbia"},
            {r:"LOGISTICS COORDINATOR",type:"S",c:"Netherlands"},
            {r:"MACHINE OPERATOR",type:"S",c:"Czech Republic"},
            {r:"MANAGER",type:"S",c:"Germany"},
            {r:"MASON",type:"S",c:"Croatia"},
            {r:"MASON / PLASTERER",type:"S",c:"Poland"},
            {r:"MASON PLASTER / TILES",type:"S",c:"Serbia"},
            {r:"MECHANICAL DRAUGHTSMAN",type:"S",c:"Sweden"},
            {r:"MECHANICAL ENGINEER",type:"S",c:"Finland"},
            {r:"MECHANICAL SUPERVISOR",type:"S",c:"Germany"},
            {r:"MOBILE CRANE OPERATOR",type:"S",c:"Poland"},
            {r:"NURSING ASSISTANT",type:"S",c:"Sweden"},
            {r:"OFFICE ASSISTANT",type:"S",c:"Latvia"},
            {r:"OFFICE CLERK",type:"S",c:"Croatia"},
            {r:"OFFICE CLERK / RECEPTIONIST",type:"S",c:"Finland"},
            {r:"PACKAGING STAFF",type:"U",c:"Poland"},
            {r:"PACKING HELPER",type:"U",c:"Czech Republic"},
            {r:"PASTRY CHEF",type:"S",c:"France"},
            {r:"PICKER / PACKER",type:"U",c:"Netherlands"},
            {r:"PIZZA CHEF",type:"S",c:"Italy"},
            {r:"PIZZA MAKERS",type:"S",c:"Finland"},
            {r:"PLUMBER",type:"S",c:"Germany"},
            {r:"POULTRY FARM HAND",type:"U",c:"Poland"},
            {r:"POULTRY FARM SUPERVISOR",type:"S",c:"Netherlands"},
            {r:"POULTRY FARM WORKER",type:"U",c:"Latvia"},
            {r:"POULTRY YARD CLEANER",type:"U",c:"Serbia"},
            {r:"PROCUREMENT / PURCHASE ASSISTANT",type:"S",c:"Germany"},
            {r:"PRODUCTION LINE WORKER",type:"U",c:"Czech Republic"},
            {r:"PROFESSIONAL COOK",type:"S",c:"France"},
            {r:"PROJECT COORDINATOR",type:"S",c:"Sweden"},
            {r:"PUMP MOTOR MECHANIC",type:"S",c:"Croatia"},
            {r:"QUALITY CONTROL (QC)",type:"S",c:"Germany"},
            {r:"RADIOLOGY X-RAY TECHNICIAN",type:"S",c:"Sweden"},
            {r:"RCC FITTER",type:"S",c:"Poland"},
            {r:"RESTAURANT SUPERVISOR",type:"S",c:"Finland"},
            {r:"RO WATER TECHNICIAN",type:"S",c:"Latvia"},
            {r:"ROLLER OPERATOR",type:"S",c:"Serbia"},
            {r:"SAFETY ENGINEER",type:"S",c:"Sweden"},
            {r:"SALES & MARKETING EXEC",type:"S",c:"Netherlands"},
            {r:"SALES & MARKETING EXECUTIVE",type:"S",c:"Finland"},
            {r:"SALES SUPERVISOR",type:"S",c:"Germany"},
            {r:"SALES WORKERS",type:"S",c:"Croatia"},
            {r:"SALES WORKERS (DUTY-FREE)",type:"S",c:"Italy"},
            {r:"SCAFFOLDER",type:"S",c:"Poland"},
            {r:"SECRETARY / PERSONAL ASSISTANT",type:"S",c:"Latvia"},
            {r:"SECURITY GUARD",type:"S",c:"Finland"},
            {r:"SOFTWARE DEVELOPER",type:"S",c:"Netherlands"},
            {r:"SOUS CHEF",type:"S",c:"France"},
            {r:"SPECIALIST DOCTOR",type:"S",c:"Germany"},
            {r:"SPRAY PAINTER",type:"S",c:"Czech Republic"},
            {r:"SPRAYER MECHANIC",type:"S",c:"Poland"},
            {r:"SPRAYER OPERATOR",type:"S",c:"Serbia"},
            {r:"STAFF BUS DRIVER / HEAVY DUTY",type:"S",c:"Sweden"},
            {r:"STAFF BUS DRIVER HEAD DUTY",type:"S",c:"Finland"},
            {r:"STEEL FIXER",type:"S",c:"Poland"},
            {r:"STEWARD",type:"U",c:"Italy"},
            {r:"STEWARD SUPERVISOR",type:"S",c:"Croatia"},
            {r:"STEWARDS",type:"U",c:"Latvia"},
            {r:"STORE KEEPER",type:"U",c:"Serbia"},
            {r:"STORE SUPERVISOR",type:"S",c:"Germany"},
            {r:"SWEEPER",type:"U",c:"Finland"},
            {r:"SYSTEM ENGINEER",type:"S",c:"Netherlands"},
            {r:"SYSTEM OPERATOR",type:"S",c:"Sweden"},
            {r:"SYSTEM SERVICE ENGINEER",type:"S",c:"Germany"},
            {r:"TAILOR",type:"S",c:"Italy"},
            {r:"TAILOR CUTTING MASTER",type:"S",c:"Croatia"},
            {r:"TANKER DRIVER / HEAVY DUTY",type:"S",c:"Poland"},
            {r:"TANKER DRIVER HEAD DUTY",type:"S",c:"Finland"},
            {r:"TIME KEEPER",type:"S",c:"Latvia"},
            {r:"TINKER",type:"S",c:"Serbia"},
            {r:"TINKER/WELDER",type:"S",c:"Czech Republic"},
            {r:"TIRE MAN",type:"S",c:"Croatia"},
            {r:"TOWER CRANE OPERATOR",type:"S",c:"Sweden"},
            {r:"TRACTOR DRIVER",type:"S",c:"Poland"},
            {r:"TRANSPORT SUPERVISOR",type:"S",c:"Germany"},
            {r:"TROLLEY HELPER",type:"U",c:"Finland"},
            {r:"TRUCK DRIVER",type:"S",c:"Netherlands"},
            {r:"TRUCK DRIVER (CODE 95)",type:"S",c:"Latvia"},
            {r:"TV MECHANIC",type:"S",c:"Serbia"},
            {r:"VETERINARY PHARMACIST",type:"S",c:"Poland"},
            {r:"VETERINARY TECHNICIAN",type:"S",c:"Croatia"},
            {r:"WAITER",type:"U",c:"Italy"},
            {r:"WAITER/WAITRESS",type:"U",c:"France"},
            {r:"WALL PAINTER",type:"S",c:"Czech Republic"},
            {r:"WARD ASSISTANT",type:"U",c:"Sweden"},
            {r:"WAREHOUSE & FACTORY WORKERS",type:"U",c:"Poland"},
            {r:"WAREHOUSE ASSISTANT",type:"U",c:"Latvia"},
            {r:"WAREHOUSE PACKER",type:"U",c:"Serbia"},
            {r:"WAREHOUSE STAFF",type:"U",c:"Finland"},
            {r:"WATER SERVICE STATION HELPER",type:"U",c:"Croatia"},
            {r:"WELDER",type:"S",c:"Germany"},
            {r:"WELDER (CERTIFIED)",type:"S",c:"Poland"},
            {r:"WELDER / FITTER",type:"S",c:"Czech Republic"},
            {r:"WORKSHOP HELPER",type:"U",c:"Latvia"}
        ];

        // --- FIXED E.164 COMPLIANT REGEX RULES ---
        // Crucial for ClickUp API Validation
        const countryRules = {
            "AFGHANISTAN": { regex: /^\+93\d{9}$/, hint: "+93 700123456" },
            "ALBANIA": { regex: /^\+355\d{8,9}$/, hint: "+355 691234567" },
            "ALGERIA": { regex: /^\+213\d{9}$/, hint: "+213 555123456" },
            "ANGOLA": { regex: /^\+244\d{9}$/, hint: "+244 923123456" },
            "ARMENIA": { regex: /^\+374\d{8}$/, hint: "+374 91123456" },
            "AZERBAIJAN": { regex: /^\+994\d{9}$/, hint: "+994 501234567" },
            "BAHRAIN": { regex: /^\+973\d{8}$/, hint: "+973 39123456" },
            "BANGLADESH": { regex: /^\+8801\d{9}$/, hint: "+880 1712345678" },
            "BENIN": { regex: /^\+229\d{8}$/, hint: "+229 97123456" },
            "BHUTAN": { regex: /^\+975\d{8}$/, hint: "+975 17123456" },
            "BOTSWANA": { regex: /^\+267\d{8}$/, hint: "+267 72123456" },
            "BRUNEI": { regex: /^\+673\d{7}$/, hint: "+673 8123456" },
            "BURKINA FASO": { regex: /^\+226\d{8}$/, hint: "+226 70123456" },
            "BURUNDI": { regex: /^\+257\d{8}$/, hint: "+257 79123456" },
            "CAMBODIA": { regex: /^\+855\d{8,9}$/, hint: "+855 12345678" },
            "CAMEROON": { regex: /^\+237\d{9}$/, hint: "+237 671234567" },
            "CAPE VERDE": { regex: /^\+238\d{7}$/, hint: "+238 9912345" },
            "CENTRAL AFRICAN REPUBLIC": { regex: /^\+236\d{8}$/, hint: "+236 75123456" },
            "CHAD": { regex: /^\+235\d{8}$/, hint: "+235 66123456" },
            "CHINA": { regex: /^\+861\d{10}$/, hint: "+86 13912345678" },
            "COMOROS": { regex: /^\+269\d{7}$/, hint: "+269 3312345" },
            "CONGO (DRC)": { regex: /^\+243\d{9}$/, hint: "+243 811234567" },
            "CONGO (REPUBLIC)": { regex: /^\+242\d{9}$/, hint: "+242 061234567" },
            "CYPRUS": { regex: /^\+357\d{8}$/, hint: "+357 99123456" },
            "DJIBOUTI": { regex: /^\+253\d{8}$/, hint: "+253 77123456" },
            "EGYPT": { regex: /^\+201\d{9}$/, hint: "+20 1012345678" },
            "EQUATORIAL GUINEA": { regex: /^\+240\d{9}$/, hint: "+240 222123456" },
            "ERITREA": { regex: /^\+291\d{7}$/, hint: "+291 7123456" },
            "ESWATINI": { regex: /^\+268\d{8}$/, hint: "+268 76123456" },
            "ETHIOPIA": { regex: /^\+251\d{9}$/, hint: "+251 911234567" },
            "GABON": { regex: /^\+241\d{7,8}$/, hint: "+241 07123456" },
            "GAMBIA": { regex: /^\+220\d{7}$/, hint: "+220 7123456" },
            "GEORGIA": { regex: /^\+995\d{9}$/, hint: "+995 599123456" },
            "GHANA": { regex: /^\+233\d{9}$/, hint: "+233 241234567" },
            "GUINEA": { regex: /^\+224\d{9}$/, hint: "+224 621234567" },
            "GUINEA-BISSAU": { regex: /^\+245\d{9}$/, hint: "+245 961234567" },
            "HONG KONG": { regex: /^\+852\d{8}$/, hint: "+852 91234567" },
            "INDIA": { regex: /^\+91[6-9]\d{9}$/, hint: "+91 9876543210" },
            "INDONESIA": { regex: /^\+628\d{9,11}$/, hint: "+62 8123456789" },
            "IRAN": { regex: /^\+989\d{9}$/, hint: "+98 9123456789" },
            "IRAQ": { regex: /^\+9647\d{9}$/, hint: "+964 7501234567" },
            "ISRAEL": { regex: /^\+9725\d{8}$/, hint: "+972 501234567" },
            "IVORY COAST": { regex: /^\+225\d{10}$/, hint: "+225 0701234567" },
            "JAPAN": { regex: /^\+81[789]0\d{8}$/, hint: "+81 9012345678" },
            "JORDAN": { regex: /^\+9627\d{8}$/, hint: "+962 791234567" },
            "KAZAKHSTAN": { regex: /^\+77\d{9}$/, hint: "+7 7012345678" },
            "KENYA": { regex: /^\+2547\d{8}$/, hint: "+254 712345678" },
            "KUWAIT": { regex: /^\+965\d{8}$/, hint: "+965 91234567" },
            "KYRGYZSTAN": { regex: /^\+996\d{9}$/, hint: "+996 555123456" },
            "LAOS": { regex: /^\+85620\d{8}$/, hint: "+856 2012345678" },
            "LEBANON": { regex: /^\+961\d{7,8}$/, hint: "+961 70123456" },
            "LESOTHO": { regex: /^\+266\d{8}$/, hint: "+266 58123456" },
            "LIBERIA": { regex: /^\+231\d{8,9}$/, hint: "+231 77123456" },
            "LIBYA": { regex: /^\+2189\d{8}$/, hint: "+218 911234567" },
            "MACAU": { regex: /^\+8536\d{7}$/, hint: "+853 66123456" },
            "MADAGASCAR": { regex: /^\+261\d{9}$/, hint: "+261 341234567" },
            "MALAWI": { regex: /^\+265\d{9}$/, hint: "+265 881234567" },
            "MALAYSIA": { regex: /^\+601\d{8,9}$/, hint: "+60 123456789" },
            "MALDIVES": { regex: /^\+960\d{7}$/, hint: "+960 7712345" },
            "MALI": { regex: /^\+223\d{8}$/, hint: "+223 76123456" },
            "MAURITANIA": { regex: /^\+222\d{8}$/, hint: "+222 46123456" },
            "MAURITIUS": { regex: /^\+2305\d{7}$/, hint: "+230 57123456" },
            "MONGOLIA": { regex: /^\+976\d{8}$/, hint: "+976 99123456" },
            "MOROCCO": { regex: /^\+212\d{9}$/, hint: "+212 612345678" },
            "MOZAMBIQUE": { regex: /^\+258\d{9}$/, hint: "+258 841234567" },
            "MYANMAR (BURMA)": { regex: /^\+959\d{7,9}$/, hint: "+95 912345678" },
            "NAMIBIA": { regex: /^\+2648\d{8}$/, hint: "+264 811234567" },
            "NEPAL": { regex: /^\+9779\d{9}$/, hint: "+977 9812345678" },
            "NIGER": { regex: /^\+227\d{8}$/, hint: "+227 96123456" },
            "NIGERIA": { regex: /^\+234[789]\d{9}$/, hint: "+234 8012345678" },
            "NORTH KOREA": { regex: /^\+850\d{8,10}$/, hint: "+850 191234567" },
            "OMAN": { regex: /^\+968\d{8}$/, hint: "+968 99123456" },
            "PAKISTAN": { regex: /^\+923\d{9}$/, hint: "+92 3001234567" },
            "PALESTINE": { regex: /^\+9705\d{8}$/, hint: "+970 591234567" },
            "PHILIPPINES": { regex: /^\+639\d{9}$/, hint: "+63 9171234567" },
            "QATAR": { regex: /^\+974\d{8}$/, hint: "+974 33123456" },
            "RWANDA": { regex: /^\+2507\d{8}$/, hint: "+250 781234567" },
            "SAO TOME & PRINCIPE": { regex: /^\+239\d{7}$/, hint: "+239 9912345" },
            "SAUDI ARABIA": { regex: /^\+9665\d{8}$/, hint: "+966 501234567" },
            "SENEGAL": { regex: /^\+221\d{9}$/, hint: "+221 771234567" },
            "SEYCHELLES": { regex: /^\+248\d{7}$/, hint: "+248 2512345" },
            "SIERRA LEONE": { regex: /^\+232\d{8}$/, hint: "+232 76123456" },
            "SINGAPORE": { regex: /^\+65\d{8}$/, hint: "+65 81234567" },
            "SOMALIA": { regex: /^\+252\d{8,9}$/, hint: "+252 615123456" },
            "SOUTH AFRICA": { regex: /^\+27\d{9}$/, hint: "+27 821234567" },
            "SOUTH KOREA": { regex: /^\+8210\d{8}$/, hint: "+82 1012345678" },
            "SOUTH SUDAN": { regex: /^\+2119\d{8}$/, hint: "+211 912345678" },
            "SRI LANKA": { regex: /^\+947\d{8}$/, hint: "+94 771234567" },
            "SUDAN": { regex: /^\+249\d{9}$/, hint: "+249 912345678" },
            "SYRIA": { regex: /^\+9639\d{8}$/, hint: "+963 941234567" },
            "TAIWAN": { regex: /^\+8869\d{8}$/, hint: "+886 912345678" },
            "TAJIKISTAN": { regex: /^\+9929\d{8}$/, hint: "+992 901234567" },
            "TANZANIA": { regex: /^\+255\d{9}$/, hint: "+255 712345678" },
            "THAILAND": { regex: /^\+66\d{9}$/, hint: "+66 812345678" },
            "TIMOR-LESTE": { regex: /^\+6707\d{7}$/, hint: "+670 77123456" },
            "TOGO": { regex: /^\+228\d{8}$/, hint: "+228 90123456" },
            "TUNISIA": { regex: /^\+216\d{8}$/, hint: "+216 20123456" },
            "TURKEY": { regex: /^\+905\d{9}$/, hint: "+90 5321234567" },
            "TURKMENISTAN": { regex: /^\+9936\d{7}$/, hint: "+993 65123456" },
            "UAE": { regex: /^\+9715\d{8}$/, hint: "+971 501234567" },
            "UGANDA": { regex: /^\+2567\d{8}$/, hint: "+256 771234567" },
            "UZBEKISTAN": { regex: /^\+9989\d{8}$/, hint: "+998 901234567" },
            "VIETNAM": { regex: /^\+84\d{9}$/, hint: "+84 901234567" },
            "YEMEN": { regex: /^\+9677\d{8}$/, hint: "+967 712345678" },
            "ZAMBIA": { regex: /^\+2609\d{8}$/, hint: "+260 971234567" },
            "ZIMBABWE": { regex: /^\+2637\d{8}$/, hint: "+263 771234567" },
            "OTHER": { regex: /^\+\d{8,15}$/, hint: "+ [CountryCode][Number]" }
        };

        const countryPageMap = {
            "Croatia": "croatia",
            "Czech Republic": "czech",
            "Albania": "albania",
            "Finland": "finland",
            "France": "france",
            "Germany": "germany",
            "Italy": "italy",
            "Latvia": "latvia",
            "Macedonia": "macedonia",
            "Netherlands": "netherlands",
            "Poland": "poland",
            "Sweden": "sweden",
            "Serbia": "serbia"
        };

        let currentMode = 'Unskilled';
        let currentPhoneRegex = null;

        // INIT
        window.onload = function() {
            setSkillMode('Unskilled'); 
            setupListeners();
            // Generate Random Case ID
            const rId = Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('refId').innerText = rId;
            document.getElementById('barcodeRef').innerText = "*" + rId + "*";
            
            // Populate Countries
            populateCountryDropdowns();
            
            // --- NEW: Set default values on load ---
            document.getElementById('presentResidence').value = "UAE";
            toggleCvUpload(true); // Ensure CV upload section is visible
            // ---------------------------------------

            // getClickUpFields(); // Disabled for production

            flatpickr("#dob", {
                dateFormat: "d/m/Y",
                disableMobile: false, 
                theme: "airbnb", // Changed to light theme
                onChange: function(selectedDates) {
                    if(selectedDates.length > 0) {
                        const age = new Date(Date.now() - selectedDates[0].getTime()).getUTCFullYear() - 1970;
                        const el = document.getElementById('age');
                        el.value = age;
                        if(age < 20) {
                            el.classList.add('border-red-500');
                            document.getElementById('ageError').classList.remove('hidden');
                        } else {
                            el.classList.remove('border-red-500');
                            document.getElementById('ageError').classList.add('hidden');
                        }
                    }
                }
            });
            
            flatpickr("#passportExp", {
                dateFormat: "d/m/Y",
                disableMobile: false, 
                theme: "airbnb" // Changed to light theme
            });
            
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('customJobSelect');
                const list = document.getElementById('jobDropdownList');
                if (dropdown && !dropdown.contains(event.target)) {
                    list.classList.add('hidden');
                    document.getElementById('jobDropdownIcon').classList.remove('rotate-180');
                }
            });
            
            // Initial call to set phone logic based on default/first residence option
            handleResidenceChange();
        };

        function setupListeners() {
            document.getElementById('sameAsMobile').addEventListener('change', function() {
                if(this.checked) {
                    const m = document.getElementById('mobile');
                    const w = document.getElementById('whatsapp');
                    w.value = m.value;
                    validatePhone('whatsapp');
                }
            });
        }
        
        // --- NEW CV UPLOAD LOGIC ---
        function toggleCvUpload(show) {
            const container = document.getElementById('cvUploadContainer');
            // Update Radio Button Status
            const radioYes = document.querySelector('input[name="hasCv"][value="yes"]');
            const radioNo = document.querySelector('input[name="hasCv"][value="no"]');

            if(show) {
                container.classList.remove('hidden');
                radioYes.checked = true;
                radioNo.checked = false;
            } else {
                container.classList.add('hidden');
                radioYes.checked = false;
                radioNo.checked = true;
                // Clear file if they toggle to NO
                document.getElementById('cvFile').value = '';
                document.getElementById('fileNameDisplay').innerText = "Tap here to upload CV";
            }
        }
        
        function handleFileSelect(input) {
            const file = input.files[0];
            const display = document.getElementById('fileNameDisplay');
            if(file) {
                if(file.size > 5 * 1024 * 1024) { // 5MB limit
                    showModal("File size exceeds 5MB limit.");
                    input.value = '';
                    display.innerText = "Tap here to upload CV";
                    return;
                }
                display.innerText = file.name;
                display.classList.add('text-brand-primary');
            } else {
                display.innerText = "Tap here to upload CV";
                display.classList.remove('text-brand-primary');
            }
        }

        // --- POPULATE COUNTRIES ---
        function populateCountryDropdowns() {
            const natSelect = document.getElementById('nationality');
            const resSelect = document.getElementById('presentResidence');
            const sortedCountries = Object.keys(countryRules).sort();

            // Clear except default
            natSelect.innerHTML = '<option value="">Select Origin</option>';
            resSelect.innerHTML = '<option value="">Select Residence</option>';

            sortedCountries.forEach(c => {
                if(c === 'OTHER') return;
                const opt1 = document.createElement('option');
                opt1.value = c;
                opt1.text = c;
                natSelect.appendChild(opt1);

                const opt2 = document.createElement('option');
                opt2.value = c;
                opt2.text = c;
                resSelect.appendChild(opt2);
            });
            
            // Add Other
            const other = document.createElement('option');
            other.value = "OTHER"; other.text = "Other";
            natSelect.appendChild(other);
            
            const other2 = document.createElement('option');
            other2.value = "OTHER"; other2.text = "Other";
            resSelect.appendChild(other2.cloneNode(true));
        }

        // --- NEW DROPDOWN & EXPERIENCE LOGIC ---

        function toggleJobDropdown(e) {
            const list = document.getElementById('jobDropdownList');
            const icon = document.getElementById('jobDropdownIcon');
            list.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        function selectJob(jobRole) {
            document.getElementById('currentJob').value = jobRole;
            document.getElementById('selectedJobText').innerText = jobRole;
            document.getElementById('selectedJobText').classList.remove('text-slate-500');
            document.getElementById('selectedJobText').classList.add('text-slate-900');
            
            // Close dropdown
            document.getElementById('jobDropdownList').classList.add('hidden');
            document.getElementById('jobDropdownIcon').classList.remove('rotate-180');
        }

        function populateDropdown(mode) {
            const listContainer = document.getElementById('jobDropdownList');
            listContainer.innerHTML = ''; // Clear existing
            
            const typeCode = mode === 'Unskilled' ? 'U' : 'S';
            const roles = jobMasterList.filter(j => j.type === typeCode).map(j => j.r).sort();
            
            if(roles.length === 0) {
                listContainer.innerHTML = '<div class="px-4 py-3 text-sm text-slate-500">No roles available</div>';
                return;
            }

            roles.forEach(r => {
                const div = document.createElement('div');
                div.className = "px-5 py-4 text-sm text-slate-700 hover:bg-blue-50 hover:text-brand-primary cursor-pointer border-b border-gray-100 last:border-0 transition-colors font-medium";
                div.innerText = r;
                div.onclick = function() { selectJob(r); };
                listContainer.appendChild(div);
            });
            
            // Reset selection display
            document.getElementById('currentJob').value = "";
            document.getElementById('selectedJobText').innerText = "Select Job Role";
            document.getElementById('selectedJobText').classList.add('text-slate-500');
        }

        function validateExperienceInput(el) {
            let val = parseInt(el.value);
            if(isNaN(val) || val < 1) el.value = 1;
            else if(val > 30) el.value = 30;
        }

        // --- CUSTOM MODAL LOGIC ---
        function showModal(msg) {
            const m = document.getElementById('messageModal');
            document.getElementById('modalText').innerText = msg;
            m.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                m.classList.remove('opacity-0');
                m.querySelector('.modal-content').classList.remove('scale-90');
                m.querySelector('.modal-content').classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const m = document.getElementById('messageModal');
            m.classList.add('opacity-0');
            m.querySelector('.modal-content').classList.add('scale-90');
            m.querySelector('.modal-content').classList.remove('scale-100');
            setTimeout(() => {
                m.classList.add('hidden');
            }, 300);
        }

        // ----------------------------------------

        // GEOGRAPHY & VALIDATION LOGIC
        
        // Handle Residence Change (Drives Phone Logic)
        function handleResidenceChange() {
            const sel = document.getElementById('presentResidence');
            const country = sel.value;
            
            // Set Global Rules
            const rule = countryRules[country] || countryRules["OTHER"];
            currentPhoneRegex = rule.regex;

            const mob = document.getElementById('mobile');
            const wa = document.getElementById('whatsapp');
            const alt = document.getElementById('altPhone'); // New Field
            
            // Extract code from hint (first part)
            // e.g. "+93 123..." -> "+93 "
            const parts = rule.hint.split(' ');
            const code = parts[0] + " "; 
            
            // Update fields with code IF empty or just a code
            if(mob.value.length < 5) mob.value = code;
            if(wa.value.length < 5) wa.value = code;
            if(alt.value.length < 5) alt.value = code;
            
            // Update Hints Text
            const mHint = document.getElementById('mobileHint');
            const wHint = document.getElementById('waHint');
            
            if(country) {
                mHint.innerText = "Format: " + rule.hint;
                wHint.innerText = "Format: " + rule.hint;
                mHint.classList.remove('opacity-0');
                wHint.classList.remove('opacity-0');
            } else {
                mHint.classList.add('opacity-0');
                wHint.classList.add('opacity-0');
            }
            
            // Reset validation states
            document.getElementById('mobileError').classList.add('hidden');
            mob.classList.remove('invalid-field', 'valid-field');
            wa.classList.remove('invalid-field', 'valid-field');
            alt.classList.remove('invalid-field', 'valid-field');
            
            document.getElementById('mobileFeedback').innerHTML = '';
            document.getElementById('waFeedback').innerHTML = '';
            document.getElementById('altPhoneFeedback').innerHTML = '';
        }

        // --- IMPROVED PHONE CLEANING FOR CLICKUP API ---
        function cleanPhoneNumber(phoneStr) {
            if(!phoneStr) return null;
            
            // 1. Remove all non-numeric and non-plus chars
            let cleaned = phoneStr.replace(/[^0-9+]/g, '');
            
            // 2. Handle "00" prefix common in Europe/Asia -> convert to +
            if(cleaned.startsWith('00')) {
                cleaned = '+' + cleaned.substring(2);
            }
            
            // 3. Ensure it starts with + if it has digits
            if(cleaned.length > 0 && !cleaned.startsWith('+')) {
                cleaned = '+' + cleaned;
            }

            // 4. Final Safety: Return null if it's just "+" or empty
            if(cleaned.length < 5) return null; 

            return cleaned;
        }
        
        // Enforce Numeric Input (allow + only at start)
        function enforcePhoneInput(el) {
            // Allow + at start, then only digits and spaces
            let val = el.value;
            // Replace any char that is NOT 0-9, space, or +
            el.value = val.replace(/[^0-9+ ]/g, '');
        }

        function validatePhone(id) {
            const el = document.getElementById(id);
            let feedback;
            if(id === 'mobile') feedback = document.getElementById('mobileFeedback');
            else if(id === 'whatsapp') feedback = document.getElementById('waFeedback');
            else feedback = document.getElementById('altPhoneFeedback');
            
            const errorMsg = document.getElementById('mobileError');
            
            // Clean spaces for regex check
            const rawVal = el.value.replace(/\s/g, '');

            if (!currentPhoneRegex) {
                 el.classList.remove('invalid-field');
                 return;
            }

            // TEST REGEX
            const isValid = currentPhoneRegex.test(rawVal);

            if (isValid) {
                el.classList.remove('invalid-field');
                el.classList.add('valid-field');
                feedback.innerHTML = '<i class="fa-solid fa-circle-check text-green-500"></i>';
                if(id==='mobile') errorMsg.classList.add('hidden');
            } else {
                el.classList.remove('valid-field');
                // Only show error style if length is substantial
                if(rawVal.length > 6) { // Increased threshold slightly
                    el.classList.add('invalid-field');
                    feedback.innerHTML = '<i class="fa-solid fa-circle-xmark text-red-500"></i>';
                } else {
                     feedback.innerHTML = '';
                }
            }
        }

        function goToStep2() {
            const age = parseInt(document.getElementById('age').value);
            if(isNaN(age) || age < 20 || age > 50) { 
                const ageField = document.getElementById('age');
                ageField.classList.add('invalid-field', 'animate-pulse');
                setTimeout(() => ageField.classList.remove('animate-pulse'), 500);
                showModal("Sorry, you are not eligible for the immigration process. (Age requirement: 20-50)"); 
                return; 
            }
            
            // STRICT PHONE VALIDATION CHECK BEFORE NEXT
            const mEl = document.getElementById('mobile');
            // Check regex against cleaned value (no spaces)
            const rawVal = mEl.value.replace(/\s/g, '');
            
            if(currentPhoneRegex && !currentPhoneRegex.test(rawVal)) {
                mEl.classList.add('invalid-field');
                const btn = document.getElementById('nextBtn');
                btn.classList.add('animate-shake');
                setTimeout(() => btn.classList.remove('animate-shake'), 500);
                document.getElementById('mobileError').classList.remove('hidden');
                
                const sel = document.getElementById('presentResidence');
                const rule = countryRules[sel.value] || countryRules["OTHER"];
                showModal(`Invalid Mobile Number Format.\n\nPlease follow the format for ${sel.value}:\n${rule.hint}`);
                return;
            }

            if(!document.getElementById('personalForm').checkValidity()) {
                document.getElementById('personalForm').reportValidity(); return;
            }

            document.getElementById('tab-1').classList.add('hidden');
            document.getElementById('tab-2').classList.remove('hidden');
            
            // Visual Update for Steps
            const s1 = document.getElementById('step-1-indicator');
            const s2 = document.getElementById('step-2-indicator');
            s1.classList.add('opacity-40', 'grayscale');
            s2.classList.remove('opacity-40', 'grayscale');
            s2.querySelector('div').classList.add('border-brand-primary', 'text-brand-primary');
            s2.querySelector('div').classList.remove('border-gray-200', 'text-gray-400');
            s2.querySelector('span').classList.add('text-brand-primary');

            const name = document.getElementById('firstName').value + " " + document.getElementById('lastName').value;
            document.getElementById('reportName').innerText = name;
            document.getElementById('avatarInitial').innerText = name.charAt(0);
            
            const today = new Date();
            document.getElementById('reportDate').innerText = today.toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function setSkillMode(mode) {
            currentMode = mode;
            const uCard = document.getElementById('cardUnskilled');
            const sCard = document.getElementById('cardSkilled');
            const uCheck = document.getElementById('checkUnskilled');
            const sCheck = document.getElementById('checkSkilled');
            const jobPanel = document.getElementById('jobDetailsPanel');
            const expWrap = document.getElementById('experienceWrapper');

            uCard.classList.remove('active'); sCard.classList.remove('active');
            uCheck.querySelector('div').classList.add('hidden');
            sCheck.querySelector('div').classList.add('hidden');
            uCheck.className = "w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all";
            sCheck.className = "w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all";

            if (mode === 'Unskilled') {
                uCard.classList.add('active');
                uCheck.className = "w-8 h-8 rounded-full border-brand-primary flex items-center justify-center bg-blue-100 shadow-sm";
                uCheck.querySelector('div').classList.remove('hidden');
                expWrap.classList.add('hidden');
            } else {
                sCard.classList.add('active');
                sCheck.className = "w-8 h-8 rounded-full border-brand-secondary flex items-center justify-center bg-purple-100 shadow-sm";
                sCheck.querySelector('div').classList.remove('hidden');
                expWrap.classList.remove('hidden');
            }

            jobPanel.classList.remove('hidden');
            populateDropdown(mode); 
            document.getElementById('reportContainer').classList.add('hidden');
        }

        function getSalary(countryCode, skillType) {
            // Helper to safe-get salary or return default
            const key = skillType === 'Unskilled' ? 'u' : 's';
            // Need to match country names from jobMasterList with salaryDb keys
            // Simple direct match for now
            const data = salaryDb[countryCode];
            if(data) return data[key] + " / Month";
            return "800 - 2,000 / Month"; // Fallback
        }

        function generateReport() {
            const role = document.getElementById('currentJob').value;
            if(!role) { showModal("Please select a target position to continue."); return; }

            const expEl = document.getElementById('experience');
            if(currentMode === 'Skilled') {
                let val = parseInt(expEl.value);
                if(isNaN(val) || val < 1) { showModal("Minimum 1 year of professional experience is required for Skilled Migration."); return; }
                if(val > 30) { showModal("Experience cannot exceed 30 years."); return; }
            }

            // Get Qualification
            const qual = document.querySelector('input[name="qualification"]:checked').value;

            document.getElementById('reportContainer').classList.remove('hidden');
            setTimeout(() => { document.getElementById('reportContainer').scrollIntoView({ behavior: 'smooth' }); }, 100);

            const jobData = jobMasterList.find(j => j.r === role);
            
            // Populate Data
            document.getElementById('topMatchCountry').innerText = jobData.c;
            document.getElementById('reportRole').innerText = role;
            document.getElementById('reportQualification').innerText = qual;
            
            // Update the NEW role display (topMatchRole_2) and existing elements
            // We use topMatchRole_2 for the redesigned Hero Card
            if(document.getElementById('topMatchRole_2')) {
                document.getElementById('topMatchRole_2').innerText = role;
            }
            
            // SALARY POPULATION
            const salaryText = getSalary(jobData.c, currentMode);
            document.getElementById('mainSalaryRange').innerText = salaryText;

            // UPDATE MAIN BUTTON LINK
            const mainBtn = document.getElementById('mainActionBtn');
            const targetPage = countryPageMap[jobData.c];
            const targetUrl = targetPage ? targetPage : 'https://bettercallimmigration.com/appointment';
            mainBtn.onclick = function() {
                 window.open(targetUrl, '_blank');
            };
            
            // Generate Expert Text
            const reasoning = document.getElementById('aiReasoning');
            let exp = "0";
            if(currentMode === 'Unskilled') {
                reasoning.innerText = `Based on current labor shortages in the ${jobData.c} general labor market, candidates applying for ${role} have a high success rate. No specific experience verification is typically required for this visa category, making it an excellent entry-level pathway for global mobility.`;
                document.getElementById('reportExp').innerText = "Entry Level";
            } else {
                exp = document.getElementById('experience').value;
                reasoning.innerText = `With ${exp} years of specialized experience as a ${role}, you meet the skilled migration criteria for ${jobData.c}. This pathway offers long-term residency options for qualified professionals in your sector, with high demand noted in major industrial regions.`;
                document.getElementById('reportExp').innerText = exp + " Years";
            }

            // Generate Alternatives
            const grid = document.getElementById('altMatchesGrid');
            grid.innerHTML = '';
            const others = jobMasterList.filter(j => j.type === jobData.type && j.c !== jobData.c).sort(() => 0.5 - Math.random()).slice(0, 3);
            others.forEach(o => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-slate-50 p-4 rounded-2xl border border-gray-100 hover:bg-white hover:border-brand-primary/30 transition-all cursor-pointer group shadow-sm hover:shadow-md";
                
                const altTargetPage = countryPageMap[o.c];
                const altTargetUrl = altTargetPage ? altTargetPage : 'https://bettercallimmigration.com/appointment';
                div.onclick = function() { window.open(altTargetUrl, '_blank'); };

                // Get Alt Salary
                const altSal = getSalary(o.c, currentMode);

                div.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center text-xl">${getFlag(o.c)}</div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-center">
                                <div class="text-sm font-bold text-slate-700 group-hover:text-brand-primary transition tracking-wide">${o.c}</div>
                                <div class="text-[10px] text-green-600 font-bold bg-green-50 px-2 py-0.5 rounded border border-green-100">${altSal}</div>
                            </div>
                            <div class="text-[10px] text-slate-400 uppercase font-medium mt-1">${o.r}</div>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right text-slate-300 text-xs group-hover:text-brand-primary transition-colors ml-2"></i>
                `;
                grid.appendChild(div);
            });

            // saveData() is called here
            saveData();
        }

        function getFlag(c) {
            const m = { "Sweden": "", "Finland": "", "Netherlands": "", "Germany": "", "Czech Republic": "", "Poland": "", "France": "", "Italy": "", "Latvia": "", "Croatia": "", "Serbia": "", "Albania": "", "Macedonia": "", "UAE": "" }; // Added UAE flag
            return m[c] || "";
        }

        // Helper to convert date string DD/MM/YYYY to Unix Timestamp (ms)
        function getUnixTime(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                // new Date(year, monthIndex, day)
                const dt = new Date(parts[2], parts[1] - 1, parts[0]);
                const ts = dt.getTime();
                return isNaN(ts) ? null : ts;
            }
            return null;
        }

        // --- NEW HELPER FOR CASING ---
        function toTitleCase(str) {
            if (!str) return "";
            return str.replace(
                /\w\S*/g,
                function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                }
            );
        }

        async function saveData() {
            // 1. Gather all data points
            const ref = document.getElementById('refId').innerText;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            
            // CONVERT TO TITLE CASE TO MATCH CLICKUP DROPDOWN OPTIONS (Usually Title Case)
            // Even if the input value is "AFGHANISTAN" (Uppercase), we send "Afghanistan"
            // FIX: Added .trim() to ensure no trailing spaces break matching
            const presentResidenceEl = document.getElementById('presentResidence');
            const presentCountry = presentResidenceEl && presentResidenceEl.value ? toTitleCase(presentResidenceEl.value.trim()) : "";
            
            const nationalityEl = document.getElementById('nationality');
            const nationality = nationalityEl && nationalityEl.value ? toTitleCase(nationalityEl.value.trim()) : "";
            
            const dob = document.getElementById('dob').value;
            const age = parseInt(document.getElementById('age').value) || 0;
            
            // Clean phone numbers: REMOVE SPACES/DASHES FOR CLICKUP SAVING
            const mobile = cleanPhoneNumber(document.getElementById('mobile').value);
            const whatsapp = cleanPhoneNumber(document.getElementById('whatsapp').value);
            const altPhone = cleanPhoneNumber(document.getElementById('altPhone').value); // New Field
            
            const qualification = document.querySelector('input[name="qualification"]:checked')?.value || '';
            const passportNo = document.getElementById('passportNo').value;
            const passportExp = document.getElementById('passportExp').value;
            const role = document.getElementById('currentJob').value;
            const exp = parseInt(document.getElementById('experience').value) || 0;
            const resultCountry = document.getElementById('topMatchCountry').innerText;

            // 2. Prepare Custom Fields Array for ClickUp
            const customFieldsArray = [];

            // FETCH OPTION IDS FOR DROPDOWNS
            let fieldDefinitions = [];
            try {
                const res = await fetch(`https://api.clickup.com/api/v2/list/${CLICKUP_LIST_ID}/field`, {
                    method: 'GET',
                    headers: { 'Authorization': CLICKUP_API_KEY }
                });
                const data = await res.json();
                fieldDefinitions = data.fields || [];
            } catch (e) {
                console.error("Failed to fetch field definitions for Dropdown mapping", e);
            }

            // UPDATED: Deep Logic to Handle Types Automatically
            const addField = (key, val) => {
                const fieldId = CLICKUP_FIELDS[key];
                
                // 1. Basic Validation
                if (!fieldId || fieldId.includes('replace_with') || val === null || val === "") {
                    if(fieldId && fieldId.includes('replace_with')) {
                        console.warn(`Skipping field '${key}': Placeholder ID detected. Update code.`);
                    }
                    return;
                }

                // 2. Find Field Definition from API
                const fieldDef = fieldDefinitions.find(f => f.id === fieldId);
                let finalValue = val;

                if (fieldDef) {
                    // --- DEBUG LOG FOR RESIDENCE ---
                    if(key === "PRESENT RESIDENCE") {
                        console.log(`[ClickUp Match] Found ID for PRESENT RESIDENCE. Attempting to match: '${val}'`);
                        // Un-comment next line to see all options in console if needed
                        // console.log("Available Options:", fieldDef.type_config.options);
                    }

                    // --- CASE A: DROPDOWN or LABELS ---
                    if (fieldDef.type === 'drop_down' || fieldDef.type === 'labels') {
                        // We must send the INTEGER INDEX (orderindex) or UUID, not the text
                        const options = fieldDef.type_config.options;
                        
                        // Try strict match first (trimmed)
                        let match = options.find(o => o.name && o.name.toLowerCase().trim() === String(val).toLowerCase().trim());
                        
                        // If strict match fails, try fuzzy match (if user sent spaces or minor chars)
                        if (!match) {
                             match = options.find(o => o.name && o.name.toLowerCase().replace(/[^a-z]/g, '') === String(val).toLowerCase().replace(/[^a-z]/g, ''));
                        }

                        if (match) {
                            // CHANGED: Prioritize UUID (match.id) over index. This fixes "Not Saved" issues in newer API versions.
                            finalValue = match.id;
                        } else {
                            // CRITICAL FIX: If exact match fails (or if API fetch failed), send the raw text value.
                            // Previously this would 'return' and skip saving the field entirely.
                            console.warn(`ClickUp Option Mismatch for ${key}: '${val}'. sending raw value.`);
                            // Fallback to sending text. If user changes field to Text/Short Text in ClickUp, this works.
                            finalValue = val; 
                        }
                    }
                    // --- CASE B: EMAIL, PHONE, URL (Validation Required by ClickUp) ---
                    else if (fieldDef.type === 'email' || fieldDef.type === 'url' || fieldDef.type === 'phone') {
                        // Ensure it's a string
                        finalValue = String(val); 
                    }
                    // --- CASE C: TEXT / SHORT TEXT ---
                    else {
                        finalValue = val; // Send as is
                    }
                } else {
                    // Fallback if we couldn't fetch definitions (e.g. network error)
                    console.log(`Field definition not found for ${key}, sending as raw value.`);
                }
                
                customFieldsArray.push({ "id": fieldId, "value": finalValue });
            };

            // Map Data to Configured IDs
            addField("SUR NAME", lastName);
            
            // Only add phones if they are valid E.164 strings
            if(mobile) addField("MOBILE", mobile);
            if(whatsapp) addField("WHATSAPP", whatsapp);
            if(altPhone) addField("PHONE", altPhone); 
            
            addField("DATE OF BIRTH", getUnixTime(dob));
            addField("AGE", age);
            addField("EMAIL", email);
            
            addField("QUALIFICATION", qualification); 
            addField("JOB ROLE", role);             
            addField("NATIONALITY", nationality);     
            
            // Explicit check here
            if(presentCountry) {
                addField("PRESENT RESIDENCE", presentCountry);     
            }
            
            addField("EXPERIENCE", exp);
            addField("PASSPORT NUMBER", passportNo);
            addField("PASSPORT EXPIRY", getUnixTime(passportExp));
            addField("Case Reference ID", ref);
            
            console.log("Saving to ClickUp Payload:", customFieldsArray);

            // 3. Send to ClickUp
            if(CLICKUP_API_KEY && CLICKUP_LIST_ID && !CLICKUP_API_KEY.includes("pk_12345")) {
                
                const fullDescription = `**FULL CANDIDATE PROFILE**
--------------------------------------------------
**CASE REFERENCE:** ${ref}
**DATE:** ${new Date().toLocaleDateString()}

**PERSONAL DETAILS**
--------------------------------------------------
**First Name:** ${firstName}
**Last Name:** ${lastName}
**Date of Birth:** ${dob}
**Age:** ${age}
**Email:** ${email}
**Nationality:** ${nationality}
**Present Residence:** ${presentCountry}

**CONTACT INFO**
--------------------------------------------------
**Mobile:** ${mobile || "N/A"}
**WhatsApp:** ${whatsapp || "N/A"}
**Alt Phone:** ${altPhone || "N/A"}

**PROFESSIONAL PROFILE**
--------------------------------------------------
**Job Role:** ${role}
**Category:** ${currentMode}
**Experience:** ${exp} Years
**Qualification:** ${qualification}

**TRAVEL DOCS**
--------------------------------------------------
**Passport No:** ${passportNo || "N/A"}
**Expiry:** ${passportExp || "N/A"}

**ASSESSMENT RESULT**
--------------------------------------------------
**Primary Recommendation:** ${resultCountry}
**Est. Salary:** ${getSalary(resultCountry, currentMode)}

--------------------------------------------------
*Verified by Better Call Immigration AI*`;

                const clickUpPayload = {
                    name: firstName, 
                    description: fullDescription, 
                    custom_fields: customFieldsArray
                };

                try {
                    // A. Create Task
                    const res = await fetch(`https://api.clickup.com/api/v2/list/${CLICKUP_LIST_ID}/task`, {
                        method: 'POST',
                        headers: { 'Authorization': CLICKUP_API_KEY, 'Content-Type': 'application/json' },
                        body: JSON.stringify(clickUpPayload)
                    });

                    if(!res.ok) {
                        const err = await res.json();
                        console.error("ClickUp Error", err);
                        showModal(`Error Saving to ClickUp: ${err.err || "Check console for details"}`);
                    } else {
                        const taskData = await res.json();
                        console.log("Saved to ClickUp! Task ID:", taskData.id);
                        
                        // B. Upload File (If selected)
                        const cvFile = document.getElementById('cvFile').files[0];
                        if (cvFile && taskData.id) {
                            try {
                                console.log("Uploading CV...");
                                const formData = new FormData();
                                formData.append("attachment", cvFile);
                                formData.append("filename", cvFile.name);

                                const uploadRes = await fetch(`https://api.clickup.com/api/v2/task/${taskData.id}/attachment`, {
                                    method: 'POST',
                                    headers: { 'Authorization': CLICKUP_API_KEY }, // No Content-Type (Browser sets boundary)
                                    body: formData
                                });
                                
                                if(uploadRes.ok) console.log("CV Uploaded Successfully");
                                else console.error("CV Upload Failed", await uploadRes.json());
                                
                            } catch(uploadErr) {
                                console.error("File Upload Network Error", uploadErr);
                            }
                        }

                        // 4. Show Toast only on success
                        showToast();
                    }
                } catch(e) { 
                    console.error("ClickUp Connection Error", e);
                    showModal("Network Error: Could not connect to ClickUp.");
                }
            } else {
                console.log("ClickUp Integration: Key not configured.");
                // Show Success Toast anyway for demo purposes if key is missing
                showToast();
            }
        }

        function showToast() {
            const t = document.getElementById('toast');
            t.classList.remove('translate-y-32','opacity-0');
            setTimeout(() => t.classList.add('translate-y-32','opacity-0'), 3000);
        }
    </script>
</body>
</html>